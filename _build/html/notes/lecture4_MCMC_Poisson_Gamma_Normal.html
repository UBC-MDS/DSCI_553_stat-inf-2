

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Lecture 4 - Markov Chain Monte Carlo, Stan, and Complex Bayesian Models &#8212; DSCI 553 - Statistical Inference and Computation II</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notes/lecture4_MCMC_Poisson_Gamma_Normal';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lecture 5 - Bayesian Normal Linear Regression and Hypothesis Testing" href="lecture5_hypothesis_testing_intro_regression.html" />
    <link rel="prev" title="Lecture 3 - Bayesian Statistics in Action: The Beta-Binomial Model" href="lecture3_beta_binomial_Bayesian_modelling.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../README.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/UBC_MDS_logo.png" class="logo__image only-light" alt="DSCI 553 - Statistical Inference and Computation II - Home"/>
    <script>document.write(`<img src="../_static/UBC_MDS_logo.png" class="logo__image only-dark" alt="DSCI 553 - Statistical Inference and Computation II - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../README.html">
                    Welcome to DSCI 553: Statistical Inference and Computation II
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Lectures</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../lecture-learning-objectives.html">Lecture Learning Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture1_intro_and_stan.html">Lecture 1 - Frequentist and Bayesian Overview, Probabilistic Generative Models, and <code class="docutils literal notranslate"><span class="pre">Stan</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture2_Bayes_MAP.html">Lecture 2 - Conditional Probabilities, Bayes’ Rule, and Maximum a Posteriori Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture3_beta_binomial_Bayesian_modelling.html">Lecture 3 - Bayesian Statistics in Action: The Beta-Binomial Model</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lecture 4 - Markov Chain Monte Carlo, <code class="docutils literal notranslate"><span class="pre">Stan</span></code>, and Complex Bayesian Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture5_hypothesis_testing_intro_regression.html">Lecture 5 - Bayesian Normal Linear Regression and Hypothesis Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture6_binary_logistic_regression.html">Lecture 6 - Bayesian Binary Logistic Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture7_hierarchical_models.html">Lecture 7 - Bayesian Hierarchical Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="lecture8_model_diagnostics.html">Lecture 8 - More Hierarchical Modelling and MCMC Diagnostics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tutorial</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="MCMC_tutorial.html">Insights of Markov Chain Monte Carlo via the Gamma-Poisson Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendices</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="appendix-dist-cheatsheet.html">Distribution Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-greek-alphabet.html">Greek Alphabet</a></li>
<li class="toctree-l1"><a class="reference internal" href="appendix-bayesian-workflow.html">The Bayesian Workflow</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/UBC-MDS/DSCI_553_stat-inf-2" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/UBC-MDS/DSCI_553_stat-inf-2/issues/new?title=Issue%20on%20page%20%2Fnotes/lecture4_MCMC_Poisson_Gamma_Normal.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notes/lecture4_MCMC_Poisson_Gamma_Normal.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lecture 4 - Markov Chain Monte Carlo, Stan, and Complex Bayesian Models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#today-s-learning-objectives">Today’s Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-r-packages">Loading <code class="docutils literal notranslate"><span class="pre">R</span></code> Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#previously">Previously…</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-big-idea">1. The Big Idea</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-design-the-model-think-generatively">1.1. To Design the Model, Think Generatively!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-likelihood">1.2. Constructing the Likelihood</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-bikeshare-data">2. The Bikeshare Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">2.1. Data Wrangling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">2.2. Exploratory Data Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bikeshare-likelihood">3. Bikeshare Likelihood</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-the-bike-ride-counts">3.1. Modelling the Bike Ride Counts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-the-weather-parameters">3.2. Modelling the Weather Parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-markov-chain-monte-carlo">4. Overview of Markov Chain Monte Carlo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-algorithm">4.1. Monte Carlo Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#markov-chain">4.2. Markov Chain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-metropolis-hastings-algorithm">4.3. The Metropolis-Hastings Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-metropolis-algorithm">4.4.  The Metropolis Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-mcmc-algorithms">4.5.  Other MCMC Algorithms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#important-facts-to-consider-when-sampling-via-rstan">4.6.  Important Facts to Consider when <code class="docutils literal notranslate"><span class="pre">sampling()</span></code> via <code class="docutils literal notranslate"><span class="pre">rstan</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-stan-to-obtain-our-posterior-distribution">5. Using <code class="docutils literal notranslate"><span class="pre">Stan</span></code> to Obtain our Posterior Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-the-model">5.1. Coding the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mcmc-simulation">5.2. MCMC Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-visualizing-and-interpreting-the-posterior-results">5.3. Obtaining, Visualizing, and Interpreting the Posterior Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-up">6. Wrapping Up</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lecture-4-markov-chain-monte-carlo-stan-and-complex-bayesian-models">
<h1>Lecture 4 - Markov Chain Monte Carlo, <code class="docutils literal notranslate"><span class="pre">Stan</span></code>, and Complex Bayesian Models<a class="headerlink" href="#lecture-4-markov-chain-monte-carlo-stan-and-complex-bayesian-models" title="Permalink to this heading">#</a></h1>
<section id="today-s-learning-objectives">
<h2>Today’s Learning Objectives<a class="headerlink" href="#today-s-learning-objectives" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Illustrate the steps to build a likelihood in a Bayesian design.</p></li>
<li><p>Explore a complex dataset involving categorical, count, and continuous variables.</p></li>
<li><p>Apply a Bayesian model design with the proper random variables (<strong>Normal</strong>, <strong>Gamma</strong>, and <strong>Poisson</strong>).</p></li>
<li><p>Explain the general procedure of Markov Chain Monte Carlo (MCMC).</p></li>
<li><p>Practice computational Bayesian inference via <code class="docutils literal notranslate"><span class="pre">Stan</span></code>.</p></li>
<li><p>Draw inferential conclusions from our posterior distribution of parameters.</p></li>
</ol>
</section>
<section id="loading-r-packages">
<h2>Loading <code class="docutils literal notranslate"><span class="pre">R</span></code> Packages<a class="headerlink" href="#loading-r-packages" title="Permalink to this heading">#</a></h2>
<div class="cell tag_remove-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.matrix.max.rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="n">repr.matrix.max.cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">janitor</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">cowplot</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">rstan</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">bayesplot</span><span class="p">)</span>
<span class="nf">library</span><span class="p">(</span><span class="n">wesanderson</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="previously">
<h2>Previously…<a class="headerlink" href="#previously" title="Permalink to this heading">#</a></h2>
<p>We have explored the Bayesian framework on a conceptual level at the beginning of the course. Then, we got familiar with the Bayes’ rule via probability theory. Recall the Bayes’ rule as one of <strong>the most powerful components in Bayesian analysis</strong>. By applying this rule, we solved a foundational model called the <strong>Beta-Binomial</strong> in which we combine two random variables via our likelihood and prior distribution. Moreover, we explored the <strong>Gamma-Poisson</strong> model during lab time.</p>
<p>Nonetheless, <strong>real-life problems are not theoretically well behaved as the Beta-Binomial and Gamma Poisson cases</strong>. Moreover, complex data will require even more diverse distributions to design our Bayesian model. Hence, the analytical application of the Bayes’ rule will not be possible for a nice exact posterior distribution.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Let us not worry! <code class="docutils literal notranslate"><span class="pre">Stan</span></code> will come in handy given this issue via MCMC to obtain an <strong>approximate posterior distribution</strong>.</p>
</div>
</section>
<section id="the-big-idea">
<h2>1. The Big Idea<a class="headerlink" href="#the-big-idea" title="Permalink to this heading">#</a></h2>
<p>Let us recall the big idea of Bayesian modelling. It involves these steps:</p>
<ol class="arabic simple">
<li><p><strong>Question:</strong> Pose a scientific question.</p></li>
<li><p><strong>Design:</strong> Formulate variables and create a probabilistic model for them. Prior knowledge is included here!</p></li>
<li><p><strong>Infer:</strong> Get <strong>posterior samples</strong> from the conditional distribution of <strong>any variable you want to infer</strong>, given your observed data and prior knowledge.</p></li>
<li><p><strong>Check:</strong> Make sure the “samples” are <em>actually</em> from your posterior (these are model diagnostics, to be covered later!)</p></li>
<li><p><strong>Analyze:</strong> Use your samples to compute summaries: mean, maximum a posteriori (MAP), variance, posterior credible intervals, etc.</p></li>
</ol>
<p>The <strong>scientific question</strong> can involve <strong>inferential</strong> and/or predictive inquiries:</p>
<ul class="simple">
<li><p><strong>Inferential:</strong> Using observed data <span class="math notranslate nohighlight">\(Y\)</span> to infer latent variable <span class="math notranslate nohighlight">\(\theta\)</span>.</p></li>
<li><p><strong>Predictive:</strong> Using observed data <span class="math notranslate nohighlight">\(Y\)</span> to predict future data <span class="math notranslate nohighlight">\(Y'\)</span>.</p></li>
</ul>
<figure class="align-default" id="graphical">
<a class="reference internal image-reference" href="../_images/graphical.png"><img alt="../_images/graphical.png" src="../_images/graphical.png" style="height: 350px;" /></a>
</figure>
<p>We already discussed their differences in <a class="reference internal" href="lecture3_beta_binomial_Bayesian_modelling.html"><span class="doc">Lecture 3 - Bayesian Statistics in Action: The Beta-Binomial Model</span></a> our via some examples. Now, let us think generatively!</p>
<section id="to-design-the-model-think-generatively">
<h3>1.1. To Design the Model, Think Generatively!<a class="headerlink" href="#to-design-the-model-think-generatively" title="Permalink to this heading">#</a></h3>
<p>Ultimately, <strong>our model is an abstraction of a complex system involving different parameters of interest</strong>. Suppose we have <span class="math notranslate nohighlight">\(d\)</span> parameters <span class="math notranslate nohighlight">\(\theta_1, \dots, \theta_d\)</span>. Mathematically, these <span class="math notranslate nohighlight">\(d\)</span> parameters can be put in a vector as follows:</p>
<div class="math notranslate nohighlight">
\[\Theta = (\theta_1, \dots, \theta_d)^T.\]</div>
<p>Note our Bayesian model is a <strong>big joint probability distribution <span class="math notranslate nohighlight">\(P(Y, Y', \Theta)\)</span></strong> over:</p>
<ul class="simple">
<li><p><strong>Things we will see.</strong> Our observations <span class="math notranslate nohighlight">\(Y\)</span>.</p></li>
<li><p><strong>Things we have to infer:</strong> Unobserved parameters <span class="math notranslate nohighlight">\(\Theta\)</span> and predicted observations <span class="math notranslate nohighlight">\(Y'\)</span>. <strong>This is why the posterior distribution of <span class="math notranslate nohighlight">\(\Theta\)</span> is key!</strong></p></li>
</ul>
<p>We already had a first <strong>inferential</strong> approach (analytically speaking!) via the Beta-Binomial model in <a class="reference internal" href="lecture3_beta_binomial_Bayesian_modelling.html"><span class="doc">Lecture 3 - Bayesian Statistics in Action: The Beta-Binomial Model</span></a>.</p>
<p>Now, it is much more intuitive to design a couple of steps that generate parameters and synthetic data:</p>
<ol class="arabic simple">
<li><p>First, generate <span class="math notranslate nohighlight">\(\Theta\)</span> from the <strong>prior</strong> <span class="math notranslate nohighlight">\(P(\Theta)\)</span>.</p></li>
<li><p>Then, generate observations <span class="math notranslate nohighlight">\(Y\)</span>, <span class="math notranslate nohighlight">\(Y'\)</span> given <span class="math notranslate nohighlight">\(\Theta\)</span> from the <strong>likelihood</strong> <span class="math notranslate nohighlight">\(P(Y,Y'|\Theta)\)</span>.</p></li>
</ol>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>We are basically applying the law of conditioning</p>
<div class="math notranslate nohighlight">
\[P(Y,Y',\Theta) = P(Y,Y'|\Theta)P(\Theta).\]</div>
</div>
<p>We will start with the <strong>likelihood.</strong> This function involves formulating certain variables. It is the core part of the model design! Then, we can establish the <strong>prior distributions for our parameters of interest</strong> within <span class="math notranslate nohighlight">\(\Theta\)</span> (the likelihood will be of a big help here).</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This whole thing is a <em>story of how our data were created</em>.</p>
</div>
<p>So far in <code class="docutils literal notranslate"><span class="pre">lab1</span></code>, we only used our generative Monte Carlo models to simulate synthetic data given some fixed parameters. Nonetheless, we did not incorporate any observed data. <strong>In <code class="docutils literal notranslate"><span class="pre">lab2</span></code>, we will need to include observed data.</strong></p>
</section>
<section id="constructing-the-likelihood">
<h3>1.2. Constructing the Likelihood<a class="headerlink" href="#constructing-the-likelihood" title="Permalink to this heading">#</a></h3>
<p>To construct the distribution of <strong>the model parameters in <span class="math notranslate nohighlight">\(\Theta\)</span> conditioned on the observed data <span class="math notranslate nohighlight">\(Y\)</span> (i.e., the likelihood)</strong>, we need to follow these steps:</p>
<ul class="simple">
<li><p><strong>Step 1</strong>: Formulate all data variables - <strong>type</strong> (integer, real, categorical, etc.) and <strong>support</strong> (positive, nonnegative, binary, etc.).</p></li>
<li><p><strong>Step 2</strong>: Figure out which variables we will take as fixed covariates, which will be randomly generated, and how they are related.</p></li>
<li><p><strong>Step 3</strong>: Pick a distribution with the right support/type/dependencies. The <strong>support</strong> refers to a proper range of plausible values. Usually, the distribution will have some <strong>UNKNOWN PARAMETERS</strong> - those will need a prior!</p></li>
</ul>
</section>
</section>
<section id="the-bikeshare-data">
<h2>2. The Bikeshare Data<a class="headerlink" href="#the-bikeshare-data" title="Permalink to this heading">#</a></h2>
<p>Let us recheck the bikeshare data. This is a complex case in which we have variables of different types.</p>
<ul class="simple">
<li><p><strong>Description:</strong> Hourly record of the number of bike trips in Washington, DC in 2011/2012.</p></li>
<li><p><strong>Source:</strong> <a class="reference external" href="https://www.kaggle.com/marklvl/bike-sharing-dataset">2011/12 Capital Bikeshare Data</a>.</p></li>
<li><p><strong>Variables:</strong>  date, hour, holiday/weekend/workday, weather, temperature, number of trips.</p></li>
</ul>
<div class="admonition-main-statistical-inquiries admonition">
<p class="admonition-title">Main statistical inquiries</p>
<p>Suppose we are interested in the following inferential inquiries:</p>
<ol class="arabic simple">
<li><p>How are temperature and weather associated with the <strong>mean</strong> number of trips?</p></li>
<li><p>Specifically, does the <strong>mean</strong> number of trips vary by the <strong>type</strong> of weather along with temperature?</p></li>
<li><p>How can we quantify this variation?</p></li>
</ol>
</div>
<p>Let us start with <strong>in-class questions</strong>.</p>
<div class="exercise admonition" id="lecture4-q1">

<p class="admonition-title"><span class="caption-number">Exercise 11 </span></p>
<section id="exercise-content">
<p>Let us retake <strong>DSCI 562</strong> topics under a frequentist approach; what regression modelling can approach the above inquiries?</p>
<p><strong>A.</strong> A generalized linear model (GLM) such as Multinomial regression.</p>
<p><strong>B.</strong> A GLM such as Ordinal Logistic regression.</p>
<p><strong>C.</strong> A GLM such as Poisson regression.</p>
<p><strong>D.</strong> Ordinary Least-squares (OLS).</p>
</section>
</div>
<section id="data-wrangling">
<h3>2.1. Data Wrangling<a class="headerlink" href="#data-wrangling" title="Permalink to this heading">#</a></h3>
<p>The data frame <code class="docutils literal notranslate"><span class="pre">bikeshare_data</span></code> contains sixteen different variables. For the sake of our example and inquiries, we will use a small subset of them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">read_csv</span><span class="p">(</span><span class="s">&quot;../data/bikeshare_hourly.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">show_col_types</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span>
<span class="n">bikeshare_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A spec_tbl_df: 17379 × 17</caption>
<thead>
	<tr><th scope=col>instant</th><th scope=col>dteday</th><th scope=col>season</th><th scope=col>yr</th><th scope=col>mnth</th><th scope=col>⋯</th><th scope=col>hum</th><th scope=col>windspeed</th><th scope=col>casual</th><th scope=col>registered</th><th scope=col>cnt</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;date&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>⋯</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>2011-01-01</td><td>1</td><td>0</td><td>1</td><td>⋯</td><td>0.81</td><td>0</td><td>3</td><td>13</td><td>16</td></tr>
	<tr><td>2</td><td>2011-01-01</td><td>1</td><td>0</td><td>1</td><td>⋯</td><td>0.80</td><td>0</td><td>8</td><td>32</td><td>40</td></tr>
	<tr><td>3</td><td>2011-01-01</td><td>1</td><td>0</td><td>1</td><td>⋯</td><td>0.80</td><td>0</td><td>5</td><td>27</td><td>32</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋱</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>17377</td><td>2012-12-31</td><td>1</td><td>1</td><td>12</td><td>⋯</td><td>0.60</td><td>0.1642</td><td> 7</td><td>83</td><td>90</td></tr>
	<tr><td>17378</td><td>2012-12-31</td><td>1</td><td>1</td><td>12</td><td>⋯</td><td>0.56</td><td>0.1343</td><td>13</td><td>48</td><td>61</td></tr>
	<tr><td>17379</td><td>2012-12-31</td><td>1</td><td>1</td><td>12</td><td>⋯</td><td>0.65</td><td>0.1343</td><td>12</td><td>37</td><td>49</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>We quickly wrangle our data, select, and rename the three variables of interest:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">weather</span></code>: A <strong>categorical variable</strong> indicating the overall weather situation. It is coded as:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">1</span></code>: Clear, Few clouds, Partly cloudy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">2</span></code>: Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">3</span></code>: Light Snow, Light Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">temp</span></code>: Temperature in Celsius degrees. The values are multiplied times 41 since they were normalized in the original dataset with the maximum value (you can check the <a class="reference external" href="https://www.kaggle.com/marklvl/bike-sharing-dataset"><code class="docutils literal notranslate"><span class="pre">Readme.txt</span></code></a>). <strong>It is a continuous variable.</strong></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ride_count</span></code>: Count of total rental bikes, including casual and registered. <strong>It is an integer-type variable.</strong></p></li>
</ul>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Originally, there was a category <code class="docutils literal notranslate"><span class="pre">4</span></code> (Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog) in <code class="docutils literal notranslate"><span class="pre">weather</span></code>. Nonetheless, only three rows contained this category. Hence, they were removed, yielding 17376 rows in total to be used.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bikeshare_data</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">select</span><span class="p">(</span><span class="n">weathersit</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">cnt</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">mutate</span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">41</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">filter</span><span class="p">(</span><span class="n">weathersit</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">4</span><span class="p">)</span>
<span class="nf">colnames</span><span class="p">(</span><span class="n">bikeshare_data</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;weather&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;temp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ride_count&quot;</span><span class="p">)</span>
<span class="n">bikeshare_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tibble: 17376 × 3</caption>
<thead>
	<tr><th scope=col>weather</th><th scope=col>temp</th><th scope=col>ride_count</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>9.84</td><td>16</td></tr>
	<tr><td>1</td><td>9.02</td><td>40</td></tr>
	<tr><td>1</td><td>9.02</td><td>32</td></tr>
	<tr><td>⋮</td><td>⋮</td><td>⋮</td></tr>
	<tr><td>1</td><td>10.66</td><td>90</td></tr>
	<tr><td>1</td><td>10.66</td><td>61</td></tr>
	<tr><td>1</td><td>10.66</td><td>49</td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">nrow</span><span class="p">(</span><span class="n">bikeshare_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">17376</div></div>
</div>
</section>
<section id="exploratory-data-analysis">
<h3>2.2. Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permalink to this heading">#</a></h3>
<p>There is a reason why the exploratory data analysis (EDA) is extremely helpful in Bayesian modelling. We might wonder, <strong>how do ride counts behave by weather category?</strong></p>
<p>Firstly, let us plot histograms of <code class="docutils literal notranslate"><span class="pre">ride_count</span></code> by category in weather. Note the <span class="math notranslate nohighlight">\(y\)</span>-axis is adjusted with <code class="docutils literal notranslate"><span class="pre">after_stat(density)</span></code> since category <code class="docutils literal notranslate"><span class="pre">3</span></code> is present in fewer rows in <code class="docutils literal notranslate"><span class="pre">bikeshare_data</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_data</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span>
<span class="w">  </span><span class="nf">tabyl</span><span class="p">(</span><span class="n">weather</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span>
<span class="w">  </span><span class="nf">adorn_pct_formatting</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A tabyl: 3 × 3</caption>
<thead>
	<tr><th scope=col>weather</th><th scope=col>n</th><th scope=col>percent</th></tr>
	<tr><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;dbl&gt;</th><th scope=col>&lt;chr&gt;</th></tr>
</thead>
<tbody>
	<tr><td>1</td><td>11413</td><td>65.7%</td></tr>
	<tr><td>2</td><td> 4544</td><td>26.2%</td></tr>
	<tr><td>3</td><td> 1419</td><td>8.2% </td></tr>
</tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span>

<span class="n">bikeshare_data_hist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">bikeshare_data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ride_count</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">after_stat</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
<span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_histogram</span><span class="p">(</span><span class="n">bins</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;darkblue&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;lightblue&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Density&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Bike Ride Count&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Histograms by Weather Category&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">weather</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_data_hist</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/7baebf9d188c65737ce6999236e3c87d772d9049476fe0a3d97500c538cd6242.png"><img alt="../_images/7baebf9d188c65737ce6999236e3c87d772d9049476fe0a3d97500c538cd6242.png" src="../_images/7baebf9d188c65737ce6999236e3c87d772d9049476fe0a3d97500c538cd6242.png" style="width: 720px; height: 420px;" /></a>
</div>
</div>
<p>Now, <strong>how can we plot the relationship between <code class="docutils literal notranslate"><span class="pre">ride_count</span></code> and <code class="docutils literal notranslate"><span class="pre">temp</span></code> by <code class="docutils literal notranslate"><span class="pre">weather</span></code> category?</strong> Let us create scatterplots of <code class="docutils literal notranslate"><span class="pre">temp</span></code> versus <code class="docutils literal notranslate"><span class="pre">ride_count</span></code> by weather <code class="docutils literal notranslate"><span class="pre">category</span></code>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Identifying patterns with count versus continuous data is not straightforward. How about if we apply what we learned in <strong>DSCI 562</strong>? Let us fit a simple <strong>frequentist</strong> Poisson regression with a log-link function with <code class="docutils literal notranslate"><span class="pre">ride_count</span></code> as a response (the in-sample predictions are plotted as red lines).</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_data_scatterplot</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">(</span><span class="n">bikeshare_data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span>
<span class="w">  </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ride_count</span>
<span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_point</span><span class="p">(</span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;blue&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Bike Ride Count&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Temperature (C)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_smooth</span><span class="p">(</span>
<span class="w">    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bikeshare_data</span><span class="p">,</span><span class="w"> </span><span class="nf">aes</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">ride_count</span><span class="p">),</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;glm&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;red&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">formula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;y ~ x&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="n">se</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">method.args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">poisson</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Scatterplots by Weather Category with Poisson Regression Fitted Lines&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">23</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">strip.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">facet_grid</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">as.factor</span><span class="p">(</span><span class="n">weather</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_data_scatterplot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/dffd6570314def2fff9601ed287ee9de35d89b3795a1892dc4a23262bfad39a0.png"><img alt="../_images/dffd6570314def2fff9601ed287ee9de35d89b3795a1892dc4a23262bfad39a0.png" src="../_images/dffd6570314def2fff9601ed287ee9de35d89b3795a1892dc4a23262bfad39a0.png" style="width: 720px; height: 420px;" /></a>
</div>
</div>
<p>Based on our previous side-by-side plots (histograms and scatterplots), let us answer the following:</p>
<div class="exercise admonition" id="lecture4-q2">

<p class="admonition-title"><span class="caption-number">Exercise 12 </span></p>
<section id="exercise-content">
<p>Graphically speaking, how do bike ride counts behave as we increase the weather category? Recall that a higher category represents harsher weather conditions.</p>
<p><strong>A.</strong> When <strong>harsher weather</strong> conditions are present, the counts of bike rides <strong>increase at a faster pace</strong> when <strong>temperature increases</strong>.</p>
<p><strong>B.</strong> When <strong>nicer weather</strong> conditions are present, the counts of bike rides <strong>decrease at a faster pace</strong> when <strong>temperature increases</strong>.</p>
<p><strong>C.</strong> There is not graphical difference on the behaviour of bike rides as temperature increases across weather categories.</p>
<p><strong>D.</strong> When <strong>nicer weather</strong> conditions are present, the counts of bike rides <strong>increase at a faster pace</strong> when <strong>temperature increases</strong>.</p>
</section>
</div>
</section>
</section>
<section id="bikeshare-likelihood">
<h2>3. Bikeshare Likelihood<a class="headerlink" href="#bikeshare-likelihood" title="Permalink to this heading">#</a></h2>
<p>We have already obtained valuable insights with our EDA to proceed with our likelihood construction. Next, we will apply this likelihood to <code class="docutils literal notranslate"><span class="pre">bikeshare_data</span></code>. <strong>It will contain appropriate random variables according to the type of variables present in the dataset.</strong></p>
<p>Note we have the following:</p>
<ul class="simple">
<li><p><strong>Weather situation</strong> <span class="math notranslate nohighlight">\(w_i \in \{1, 2, 3\}\)</span> (categorical, where <code class="docutils literal notranslate"><span class="pre">3</span></code> indicates the harshest conditions).</p></li>
<li><p><strong>Temperature</strong> <span class="math notranslate nohighlight">\(t_i \in \mathbb{R}\)</span> (numerical).</p></li>
<li><p><strong>Number of bike rides</strong> <span class="math notranslate nohighlight">\(r_i\)</span> (non-negative count).</p></li>
</ul>
<section id="modelling-the-bike-ride-counts">
<h3>3.1. Modelling the Bike Ride Counts<a class="headerlink" href="#modelling-the-bike-ride-counts" title="Permalink to this heading">#</a></h3>
<p>We do not need to <strong>generate</strong> temperature <span class="math notranslate nohighlight">\(t_i\)</span> and weather situation <span class="math notranslate nohighlight">\(w_i\)</span> for observation <span class="math notranslate nohighlight">\(i\)</span> from our model. <strong>We are not making a weather forecast model. We are only making inference here!</strong> These are <strong>covariates</strong> that will modify the likelihood of our observations <span class="math notranslate nohighlight">\(r_i\)</span> (<strong>count of bike rides</strong>):</p>
<ul class="simple">
<li><p>In regression, you have <strong>inputs</strong> and <strong>output</strong>.</p></li>
<li><p>Inputs are covariates in this case. We expect more rides when it is warmer <strong>OR</strong> weather is nicer (recall our EDA!). Thus, <span class="math notranslate nohighlight">\(w_i\)</span> and <span class="math notranslate nohighlight">\(t_i\)</span> (inputs) should influence <span class="math notranslate nohighlight">\(r_i\)</span> (output).</p></li>
</ul>
<p>So our model’s observations <span class="math notranslate nohighlight">\(Y\)</span> will be the collection of trip counts in <code class="docutils literal notranslate"><span class="pre">bikeshare_data</span></code> <span class="math notranslate nohighlight">\((r_1, r_2, \dots)\)</span>. These are the rows in column <code class="docutils literal notranslate"><span class="pre">ride_count</span></code>.</p>
<p>We start with the rides <span class="math notranslate nohighlight">\(r_i\)</span>, which are counts. Hence, a suitable random variable for our Bayesian model is <a class="reference internal" href="appendix-dist-cheatsheet.html#poisson-distribution"><span class="std std-ref"><strong>Poisson distribution</strong></span></a> whose mean <span class="math notranslate nohighlight">\(\lambda\)</span> is theoretically equal to its variance.</p>
<table style="font-size: 30px">
    <tr>
        <th>
           <center>Poisson Distribution</center>
<img style="float: right;" width="400" src="https://upload.wikimedia.org/wikipedia/commons/thumb/1/16/Poisson_pmf.svg/1920px-Poisson_pmf.svg.png"/>
        </th>
    </tr>
</table>
<blockquote>
<div><p><strong>Source:</strong> Poisson distribution. (2025, January 25). In Wikipedia. <a class="reference external" href="https://en.wikipedia.org/wiki/Poisson_distribution">https://en.wikipedia.org/wiki/Poisson_distribution</a></p>
</div></blockquote>
<p>Therefore, the <strong>LIKELIHOOD</strong> for bike ride counts is modelled as:</p>
<div class="math notranslate nohighlight">
\[R_i \sim \text{Poisson}\left(\lambda_{w_i}(t_i)\right).\]</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In the context of this problem, Poisson’s mean will be in function of temperature <span class="math notranslate nohighlight">\(t_i\)</span> <strong>along</strong> with the type of weather <span class="math notranslate nohighlight">\(w_i\)</span>.</p>
</div>
<div class="hint admonition">
<p class="admonition-title">How to define <span class="math notranslate nohighlight">\(\lambda_{w_i}(t_i)\)</span>?</p>
<p>This is one of the most critical modelling tasks, and we will need to use some distribution theory here, along with a mathematical function. Statistically speaking, the Poisson mean <strong>cannot be negative</strong>, even though it could be continuous!</p>
<p>Furthermore, let us make a <strong>strong assumption</strong> in our modelling. We will assume riders will start taking biking trips at a specific temperature, and <strong>the riding rate will linearly increase with warmer temperature values</strong>.</p>
</div>
<p>Mathematically, <span class="math notranslate nohighlight">\(\lambda_{w_i}(t_i)\)</span> can be represented as:</p>
<div class="math notranslate nohighlight" id="equation-poisson-lambda">
<span class="eqno">(7)<a class="headerlink" href="#equation-poisson-lambda" title="Permalink to this equation">#</a></span>\[\begin{equation}
\lambda_w(t) =  \log\{1+\exp[a_w (t - l_{w})]\}.
\end{equation}\]</div>
<p>The log-transformation is applying the idea we explored in <a class="reference external" href="https://ubc-mds.github.io/DSCI_562_regr-2/notes/lecture1-glm-link-functions-and-count-regression.html#poisson-regression">Poisson regression</a>. This also creates some unknown parameters for each <span class="math notranslate nohighlight">\(w \in \{1, 2, 3\}\)</span>:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(a_w\)</span> is the <strong>slope</strong> of mean trips in weather <span class="math notranslate nohighlight">\(w\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(l_w\)</span> is the <strong>elbow location</strong> where riders start taking trips in weather <span class="math notranslate nohighlight">\(w\)</span>.</p></li>
</ul>
<p>It will be easier to visualize function <a class="reference internal" href="#equation-poisson-lambda">(7)</a> in plots with different values for <span class="math notranslate nohighlight">\(a_w\)</span> and <span class="math notranslate nohighlight">\(l_w\)</span>.</p>
<p>Suppose that for a weather category <span class="math notranslate nohighlight">\(w\)</span> we model the following values:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(a_w = 15\)</span> and <span class="math notranslate nohighlight">\(l_w = 10\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(a_w = 10\)</span> and <span class="math notranslate nohighlight">\(l_w = 0\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(a_w = 5\)</span> and <span class="math notranslate nohighlight">\(l_w = -5\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(a_w = 2\)</span> and <span class="math notranslate nohighlight">\(l_w = -10\)</span>.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span>

<span class="c1"># Function to plot the mean count of bike rides over temperature values from -20 to 40 Celsius degrees.</span>
<span class="c1"># Parameters a and l need to be provided.</span>
<span class="n">plot_mean_function</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">plot_title</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">xlim</span><span class="p">(</span><span class="m">-20</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_function</span><span class="p">(</span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l</span><span class="p">))),</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;darkgreen&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;darkorange&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Mean Bike Ride Count&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Temperature (C)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">      </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">      </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">      </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">      </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">ggtitle</span><span class="p">(</span><span class="n">plot_title</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">ylim</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">500</span><span class="p">)</span>
<span class="p">}</span>
<span class="w">                  </span>
<span class="n">a_15_l_10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">plot_mean_function</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">plot_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a = 15 and l = 10&quot;</span><span class="p">)</span><span class="w">                  </span>
<span class="n">a_10_l_0</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">plot_mean_function</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">plot_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a = 10 and l = 0&quot;</span><span class="p">)</span>
<span class="n">a_5_l_minus_5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">plot_mean_function</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-5</span><span class="p">,</span><span class="w"> </span><span class="n">plot_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a = 5 and l = -5&quot;</span><span class="p">)</span>
<span class="n">a_2_l_minus_10</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">plot_mean_function</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-10</span><span class="p">,</span><span class="w"> </span><span class="n">plot_title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;a = 2 and l = -10&quot;</span><span class="p">)</span><span class="w">                 </span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">a_15_l_10</span><span class="p">,</span><span class="w"> </span><span class="n">a_10_l_0</span><span class="p">,</span><span class="w"> </span><span class="n">a_5_l_minus_5</span><span class="p">,</span><span class="w"> </span><span class="n">a_2_l_minus_10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/1f8c8791324d1cc3d50060840b70045d59d3757447989c0814ed67eba78d95fe.png"><img alt="../_images/1f8c8791324d1cc3d50060840b70045d59d3757447989c0814ed67eba78d95fe.png" src="../_images/1f8c8791324d1cc3d50060840b70045d59d3757447989c0814ed67eba78d95fe.png" style="width: 720px; height: 720px;" /></a>
</div>
</div>
<div class="exercise admonition" id="lecture4-q3">

<p class="admonition-title"><span class="caption-number">Exercise 13 </span></p>
<section id="exercise-content">
<p><strong>Descriptively</strong>, what is the behaviour of our modelling function for <span class="math notranslate nohighlight">\(\lambda_w(t)\)</span>?</p>
</section>
</div>
</section>
<section id="modelling-the-weather-parameters">
<h3>3.2. Modelling the Weather Parameters<a class="headerlink" href="#modelling-the-weather-parameters" title="Permalink to this heading">#</a></h3>
<p>We know weather status is <strong>categorical</strong>, temperature is <strong>real</strong>, and the number of rides is a <strong>non-negative integer count</strong>. Moreover, let us assume weather status and temperature are <strong>fixed covariates</strong> (we are not trying to model them). <strong>The counts will be Poisson distributed.</strong></p>
<p>Nonetheless, our previous modelling of the behaviour of <span class="math notranslate nohighlight">\(\lambda_{w_i}(t_i)\)</span> yielded six different <strong>parameters</strong> we need to model! Thus, let us find some suitable distributions for:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(a_w\)</span> with <span class="math notranslate nohighlight">\(w\in\{1,2,3\}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(l_w\)</span> with <span class="math notranslate nohighlight">\(w\in\{1,2,3\}\)</span>.</p></li>
</ul>
<p>Our previous plots with different values of <span class="math notranslate nohighlight">\(a_w\)</span> and <span class="math notranslate nohighlight">\(l_w\)</span> shed light on what class of distributions will be suitable in our model:</p>
<ul class="simple">
<li><p>For the <strong>CONTINUOUS</strong> slopes <span class="math notranslate nohighlight">\(a_w\)</span>, we will assume they will only take on nonnegative values. A handy distribution for this case is the <a class="reference internal" href="appendix-dist-cheatsheet.html#gamma-distribution"><span class="std std-ref"><strong>Gamma distribution</strong></span></a></p></li>
<li><p>On the other hand, we will allow the <strong>CONTINUOUS</strong> elbows <span class="math notranslate nohighlight">\(l_w\)</span> to take on any real value. Thus, the <a class="reference internal" href="appendix-dist-cheatsheet.html#normal-distribution"><span class="std std-ref"><strong>Normal distribution</strong></span></a>.</p></li>
</ul>
<table style="font-size: 30px">
    <tr>
       <th> 
           <center>Gamma Distribution</center>
    <img width="500" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Gamma_distribution_pdf.svg/1920px-Gamma_distribution_pdf.svg.png"/>
        </th>
        <th>    
           <center>Normal Distribution </center>
<img width="500" src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/74/Normal_Distribution_PDF.svg/1920px-Normal_Distribution_PDF.svg.png"/>
        </th>
    </tr>
</table>
<blockquote>
<div><p><strong>Sources:</strong></p>
<p>Gamma distribution. (2025, January 14). In Wikipedia. <a class="reference external" href="https://en.wikipedia.org/wiki/Gamma_distribution">https://en.wikipedia.org/wiki/Gamma_distribution</a></p>
<p>Normal distribution. (2025, January 26). In Wikipedia. <a class="reference external" href="https://en.wikipedia.org/wiki/Normal_distribution">https://en.wikipedia.org/wiki/Normal_distribution</a></p>
</div></blockquote>
<p>Therefore, our <strong>prior distributions</strong> for these weather parameters would be:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gather*}
l_w \sim \mathcal{N}(\mu, \sigma^2) \quad \text{for} \quad w\in\{1,2,3\} \\
a_w \sim \mathrm{Gamma}(k, \theta) \quad \text{for} \quad w\in\{1,2,3\}.
\end{gather*}\end{split}\]</div>
<p>Now, we have <strong>hyperparameters</strong>! They are <span class="math notranslate nohighlight">\(\mu\)</span>, <span class="math notranslate nohighlight">\(\sigma^2\)</span>, <span class="math notranslate nohighlight">\(k\)</span> and <span class="math notranslate nohighlight">\(\theta\)</span>.</p>
<p>Moreover, we will make them reflect uncertainty:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{gather*}
\mu = 0 \\
\sigma^2 = 15^2 = 225 \\
k = 1 \\
\theta = 1.
\end{gather*}\end{split}\]</div>
<p>The corresponding prior distributions for <span class="math notranslate nohighlight">\(l_w\)</span> and <span class="math notranslate nohighlight">\(a_w\)</span> are plotted below (<strong>the prior means are the vertical dashed red lines</strong>). Note we are giving considerable uncertainty to <span class="math notranslate nohighlight">\(l_w\)</span> while allowing any real number. On the other hand, we restrict <span class="math notranslate nohighlight">\(a_w\)</span> to nonnegative numbers while allocating larger probabilities to small values (<strong>i.e., we are not expecting large rates of change for the mean counts of bike rides</strong>).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">options</span><span class="p">(</span><span class="n">repr.plot.height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">repr.plot.width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span>

<span class="c1"># Plotting Normal prior for l_w</span>
<span class="n">prior_l_w</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">xlim</span><span class="p">(</span><span class="m">-50</span><span class="p">,</span><span class="w"> </span><span class="m">50</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ylim</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0.03</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_function</span><span class="p">(</span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dnorm</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">sd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">),</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;darkred&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Density&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">expression</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s">&quot;w&quot;</span><span class="p">]))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s">&quot;Prior Distribution for l&quot;</span><span class="p">[</span><span class="s">&quot;w&quot;</span><span class="p">]))</span>

<span class="c1"># Plotting Gamma prior for a_w</span>
<span class="n">prior_a_w</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">xlim</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ylim</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">1.2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_function</span><span class="p">(</span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dgamma</span><span class="p">,</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;darkred&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;dashed&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">linewidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Density&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">expression</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="s">&quot;w&quot;</span><span class="p">]))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="s">&quot;Prior Distribution for a&quot;</span><span class="p">[</span><span class="s">&quot;w&quot;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">plot_grid</span><span class="p">(</span><span class="n">prior_l_w</span><span class="p">,</span><span class="w"> </span><span class="n">prior_a_w</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/ac3197f63760d203e0b4a10ac52944ff15e91b5ef4c9588c34f101cd3f078b54.png"><img alt="../_images/ac3197f63760d203e0b4a10ac52944ff15e91b5ef4c9588c34f101cd3f078b54.png" src="../_images/ac3197f63760d203e0b4a10ac52944ff15e91b5ef4c9588c34f101cd3f078b54.png" style="width: 720px; height: 420px;" /></a>
</div>
</div>
<p>Finally, with a dataset containing <span class="math notranslate nohighlight">\(n\)</span> observations (i.e., rows in <code class="docutils literal notranslate"><span class="pre">bikeshare_data</span></code>), for the <span class="math notranslate nohighlight">\(i\)</span>th observation <span class="math notranslate nohighlight">\((i = 1, \dots, n)\)</span> with temperature <span class="math notranslate nohighlight">\(t_i\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\text{likelihood:} \qquad R_i \mid a_{w_i}, l_{w_i} \mathop\sim^\text{ind} \text{Poisson}\left(\lambda_{w_i}(t_i)\right) \\ \text{where} \quad \lambda_{w_i}(t_i) =  \log\{1+\exp[a_{w_i} (t_i - l_{w_i})]\} \quad \text{and} \quad w_i \in \{1, 2, 3\} \\
\text{priors:} \quad a_{w_i} \sim \mathrm{Gamma}(k = 1, \theta = 1) \\
\qquad l_{w_i} \sim \mathcal{N}(\mu = 0, \sigma^2 = 15^2).
\end{align*}\end{split}\]</div>
</section>
</section>
<section id="overview-of-markov-chain-monte-carlo">
<h2>4. Overview of Markov Chain Monte Carlo<a class="headerlink" href="#overview-of-markov-chain-monte-carlo" title="Permalink to this heading">#</a></h2>
<p><strong>In general</strong>, a Bayesian model will have <span class="math notranslate nohighlight">\(d\)</span> parameters of interest for which we will need to obtain a <strong>joint posterior distribution</strong>:</p>
<div class="math notranslate nohighlight">
\[\Theta = (\theta_1, \dots, \theta_d)^T.\]</div>
<p>Recall the Bayes’ rule:</p>
<div class="math notranslate nohighlight">
\[\text{posterior} = \frac{\text{prior} \times \text{likelihood}}{\text{normalizing constant}} \propto \text{prior} \times \text{likelihood}.\]</div>
<p>Using <span class="math notranslate nohighlight">\(\Theta\)</span> as our parameter <strong>vector</strong> of interest, let <span class="math notranslate nohighlight">\(f(\Theta)\)</span> be the <strong>multivariate</strong> joint prior. Moreover with our observed data <span class="math notranslate nohighlight">\(\mathbf{y} = (y_1, \dots, y_n)^T\)</span>, let <span class="math notranslate nohighlight">\(\mathscr{l}(\Theta \mid \mathbf{y})\)</span> be the corresponding <strong>multivariate</strong> likelihood function along with the <strong>multivariate</strong> normalizing constant <span class="math notranslate nohighlight">\(f(\mathbf{y})\)</span>.</p>
<p>Then, for the <strong>multivariate</strong> joint posterior <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span>, the Bayes’ rule becomes:</p>
<div class="math notranslate nohighlight">
\[f(\Theta \mid \mathbf{y}) = \frac{f(\Theta) \times \mathscr{l}(\Theta \mid \mathbf{y})}{f(\mathbf{y})} \propto f(\Theta) \times \mathscr{l}(\Theta \mid \mathbf{y}).\]</div>
<p>Why are we highlighting <strong>multivariate</strong> all the time? It is because we have <span class="math notranslate nohighlight">\(d\)</span> parameters in vector <span class="math notranslate nohighlight">\(\Theta\)</span>.</p>
<p>Suppose we want to obtain an <strong>analytical</strong> form for <span class="math notranslate nohighlight">\(f(\mathbf{y})\)</span>, then this will be an integral to solve:</p>
<div class="math notranslate nohighlight">
\[f(\mathbf{y}) = \int_{\theta_1} \int_{\theta_2} \cdots \int_{\theta_d} f(\Theta) \mathscr{l}(\Theta \mid \mathbf{y}) d\theta_d\ \cdots d\theta_1.\]</div>
<p>Solving this multivariate integral looks pretty challenging! Nonetheless, recall we do not need to obtain <span class="math notranslate nohighlight">\(f(\mathbf{y})\)</span>, but we still need to work around the math in</p>
<div class="math notranslate nohighlight">
\[f(\Theta \mid \mathbf{y}) \propto f(\Theta) \times \mathscr{l}(\Theta \mid \mathbf{y}).\]</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Cases such as the Beta-Binomial and Gamma-Poisson are <strong>well behaved and approachable</strong> for parameters <span class="math notranslate nohighlight">\(\pi\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span>, respectively. Therefore, we can obtain a <strong>closed solution</strong> for the corresponding posterior distribution.</p>
<p>But, <strong>what can we do when we have a whole set of parameters in vector <span class="math notranslate nohighlight">\(\Theta\)</span>?</strong> It will not be possible to find an exact form for <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span>, but it is possible to approximate it via an algorithm!</p>
</div>
<p>Let us explore the MCMC algorithm by parts: <strong>Markov Chain</strong> and <strong>Monte Carlo</strong>.</p>
<section id="monte-carlo-algorithm">
<h3>4.1. Monte Carlo Algorithm<a class="headerlink" href="#monte-carlo-algorithm" title="Permalink to this heading">#</a></h3>
<p>We will start with the simple Monte Carlo algorithm. Suppose you have a closed analytical form for the posterior distribution <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span> (e.g., the Beta posterior in the Beta-Binomial model). You can build your <strong>independent</strong> Monte Carlo sample <span class="math notranslate nohighlight">\(\{ \Theta_1, \dots, \Theta_N \}\)</span> of size <span class="math notranslate nohighlight">\(N\)</span>, from <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span> by selecting each element <span class="math notranslate nohighlight">\(\Theta_i\)</span> (<span class="math notranslate nohighlight">\(i = 1, \dots, N\)</span>) in the following way:</p>
<ul class="simple">
<li><p><strong>Step 1.</strong> Draw <span class="math notranslate nohighlight">\(\Theta_i\)</span> from <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span>.</p></li>
<li><p><strong>Step 2.</strong> Go there.</p></li>
</ul>
<p>This is a random walk!</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Drawing <strong>fully independent</strong> elements for our sample <strong>WILL NOT</strong> be possible in MCMC. Moreover, <strong>note that <span class="math notranslate nohighlight">\(n \neq N\)</span></strong>.</p>
</div>
</section>
<section id="markov-chain">
<h3>4.2. Markov Chain<a class="headerlink" href="#markov-chain" title="Permalink to this heading">#</a></h3>
<p>Here comes the MCMC twist to the previous Monte Carlo approach: <strong>Markov Chain</strong>.</p>
<p><strong>What is a Markov Chain?</strong> In terms of our Bayesian modelling for the posterior, it is a sequence <span class="math notranslate nohighlight">\(\{ \Theta_1, \dots, \Theta_N \}\)</span> of size <span class="math notranslate nohighlight">\(N\)</span> whose elements are <strong>NOT ENTIRELY INDEPENDENT</strong> (hence the word <strong>chain</strong>!).</p>
<p><strong>What does NOT ENTIRELY INDEPENDENT implicate?</strong> It implicates the so-called <strong>Markov property</strong>:</p>
<blockquote>
<div><p><em>The next sampled <span class="math notranslate nohighlight">\(\Theta_{i + 1}\)</span> will depend on the current <span class="math notranslate nohighlight">\(\Theta_{i}\)</span> but not on previous <span class="math notranslate nohighlight">\(\Theta_{i - 1}, \Theta_{i - 2}, \dots\)</span></em></p>
</div></blockquote>
<p>More formally, because of this property, the conditional probability function of <span class="math notranslate nohighlight">\(\Theta_{i + 1}\)</span> can be depicted as:</p>
<div class="math notranslate nohighlight">
\[f(\Theta_{i + 1} \mid \Theta_{i}, \mathbf{y}) = f(\Theta_{i + 1} \mid \Theta_1, \Theta_2, \dots \Theta_{i}, \mathbf{y}).\]</div>
<p>Again, <strong>there is no free lunch here!</strong> Each element in this chain can be drawn <strong>from another distribution and not specifically from our target posterior <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span></strong>:</p>
<div class="math notranslate nohighlight">
\[f(\Theta_{i + 1} \mid \Theta_{i}, \mathbf{y}) \neq f(\Theta_{i + 1} \mid \mathbf{y}).\]</div>
<p>Thus, what is the point of this Markov Chain approach? The answer lies in the MCMC algorithm that approximates <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span> via our <span class="math notranslate nohighlight">\(N\)</span> elements in the chain.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>There is more than one MCMC algorithm to do so, and the foundational one is the Metropolis-Hastings algorithm.</p>
</div>
</section>
<section id="the-metropolis-hastings-algorithm">
<h3>4.3. The Metropolis-Hastings Algorithm<a class="headerlink" href="#the-metropolis-hastings-algorithm" title="Permalink to this heading">#</a></h3>
<p>This is the algorithm that will allow us to obtain <strong>an approximation of the posterior distribution <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span></strong> via our Markov Chain <span class="math notranslate nohighlight">\(\{ \Theta_1, \dots, \Theta_N \}\)</span>. Hence, with <span class="math notranslate nohighlight">\(\Theta_i\)</span> in our current iteration <span class="math notranslate nohighlight">\((i = 1, 2, \dots, N - 1)\)</span>, the next iteration <span class="math notranslate nohighlight">\(\Theta_{i + 1}\)</span> will be selected through a two-step process.</p>
<p>Recall the Bayes’ rule:</p>
<div class="math notranslate nohighlight">
\[f(\Theta \mid \mathbf{y}) \propto f(\Theta) \times \mathscr{l}(\Theta \mid \mathbf{y}).\]</div>
<p>Let the current <span class="math notranslate nohighlight">\(\Theta_i = \Theta\)</span>. Then, the algorithm’s two steps are:</p>
<ul class="simple">
<li><p><strong>Step 1.</strong> Randomly draw a new location <span class="math notranslate nohighlight">\(\Theta'\)</span> from a proposed model with PDF <span class="math notranslate nohighlight">\(q(\Theta' \mid \Theta)\)</span>. This proposed model is what we call a jumping distribution and it could be a <strong>Uniform</strong> or <strong>Normal</strong> which are symmetric.</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Another choice of a jumping distribution could be <strong>asymmetric</strong>, such as the <strong>Log-normal</strong>. We can choose this jumping distribution class when there are constraints on our parameters of interest (e.g., they are nonnegative), or we want to sample large values from the chain (recall the Log-normal is a heavy-tailed distribution).</p>
</div>
<ul class="simple">
<li><p><strong>Step 2.</strong> Now, let us decide to go or not to go to the proposed <span class="math notranslate nohighlight">\(\Theta'\)</span>:</p></li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p><strong>Step 2</strong> is divided in two parts:</p>
<p>a. Compute the acceptance probability for <span class="math notranslate nohighlight">\(\Theta'\)</span>:</p>
<div class="math notranslate nohighlight">
\[\alpha = \min \bigg\{ 1, \frac{f(\Theta') \mathscr{l}(\Theta' \mid \mathbf{y})}{f(\Theta) \mathscr{l}(\Theta \mid \mathbf{y})} \times \frac{q(\Theta \mid \Theta')}{q(\Theta' \mid \Theta)} \bigg\}.\]</div>
<p>b. Obtain the next location <span class="math notranslate nohighlight">\(\Theta_{i + 1}\)</span> as a Bernoulli trial (<strong>flipping an unfair coin!</strong>) taking on the two possible values:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\Theta_{i + 1} =
\begin{cases}
\Theta' \; \; \; \; \mbox{with probability } \alpha\\
\Theta \; \; \; \; \mbox{with probability } 1 -\alpha.
\end{cases}
\end{split}\]</div>
</div>
</section>
<section id="the-metropolis-algorithm">
<h3>4.4.  The Metropolis Algorithm<a class="headerlink" href="#the-metropolis-algorithm" title="Permalink to this heading">#</a></h3>
<p>The previous Metropolis-Hastings algorithm can be simplified when the PDF of the jumping distribution is Uniform such that:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{equation*}
q(\Theta' \mid \Theta) = q(\Theta \mid \Theta') =
\begin{cases}
\frac{1}{2w} \; \; \; \; \mbox{when $\Theta$ and $\Theta'$ are within $w$ units of each other} \\
0 \; \; \; \; 	\mbox{otherwise.}
\end{cases}
\end{equation*}\end{split}\]</div>
<p>This jumping distribution allocates the same probability of switching from <span class="math notranslate nohighlight">\(\Theta\)</span> to <span class="math notranslate nohighlight">\(\Theta'\)</span> compared to switching from <span class="math notranslate nohighlight">\(\Theta'\)</span> to <span class="math notranslate nohighlight">\(\Theta\)</span>. Note that <span class="math notranslate nohighlight">\(w\)</span> is the window parameter. Having said that, the definition of <span class="math notranslate nohighlight">\(\alpha\)</span> will change to:</p>
<div class="math notranslate nohighlight">
\[\alpha = \min \bigg\{ 1, \frac{f(\Theta') \mathscr{l}(\Theta' \mid \mathbf{y})}{f(\Theta) \mathscr{l}(\Theta \mid \mathbf{y})} \bigg\}.\]</div>
</section>
<section id="other-mcmc-algorithms">
<h3>4.5.  Other MCMC Algorithms<a class="headerlink" href="#other-mcmc-algorithms" title="Permalink to this heading">#</a></h3>
<p>Metropolis-Hastings and its simplified Metropolis version are only a couple of MCMC tools. These two approaches target single parameters (e.g., a probability of success <span class="math notranslate nohighlight">\(\pi\)</span> or a mean <span class="math notranslate nohighlight">\(\lambda\)</span>). However, when we want to deal with <span class="math notranslate nohighlight">\(d\)</span> parameters, such as <span class="math notranslate nohighlight">\(\Theta = (\theta_1, \dots, \theta_d)^T\)</span>, there are more complex tools like Gibbs sampling (used in <a class="reference external" href="https://mcmc-jags.sourceforge.io">JAGS, Just Another Gibbs Sampler</a>) or the <a class="reference external" href="https://www.jmlr.org/papers/volume15/hoffman14a/hoffman14a.pdf"><strong>No-U-Turn sampler (NUTS)</strong></a> which is a Hamiltonian Monte Carlo (HMC) algorithm (implemented in <a class="reference external" href="https://mc-stan.org/docs/reference-manual/hamiltonian-monte-carlo.html"><code class="docutils literal notranslate"><span class="pre">Stan</span></code></a>).</p>
</section>
<section id="important-facts-to-consider-when-sampling-via-rstan">
<h3>4.6.  Important Facts to Consider when <code class="docutils literal notranslate"><span class="pre">sampling()</span></code> via <code class="docutils literal notranslate"><span class="pre">rstan</span></code><a class="headerlink" href="#important-facts-to-consider-when-sampling-via-rstan" title="Permalink to this heading">#</a></h3>
<p>The MCMC algorithm has a <strong>learning curve</strong>; thus, the Markov Chain initially starts sampling unreasonable numbers to approximate the posterior <span class="math notranslate nohighlight">\(f(\Theta \mid \mathbf{y})\)</span>. Therefore, we have a <strong>burn-in stage</strong> at the beginning of <code class="docutils literal notranslate"><span class="pre">sampling()</span></code> defined by the parameter <code class="docutils literal notranslate"><span class="pre">warmup</span></code>. This parameter will discard the first <code class="docutils literal notranslate"><span class="pre">warmup</span></code> iterations for the final simulation output.</p>
<p>Recall that consecutive elements in the chain <strong>are not independent</strong>. Hence, given the Markov property, we could skip draws between our definitive sampled values throughout the simulation to achieve <strong>a certain degree of sampling independence</strong>. This is defined by <code class="docutils literal notranslate"><span class="pre">thin</span></code>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>We will obtain the following number of <strong>approximate posterior samples</strong> via <code class="docutils literal notranslate"><span class="pre">sampling()</span></code>:</p>
<div class="math notranslate nohighlight">
\[\texttt{Number of approximate posterior samples} = \frac{\texttt{iter} - \texttt{warmup}}{\texttt{thin}}.\]</div>
</div>
</section>
</section>
<section id="using-stan-to-obtain-our-posterior-distribution">
<h2>5. Using <code class="docutils literal notranslate"><span class="pre">Stan</span></code> to Obtain our Posterior Distribution<a class="headerlink" href="#using-stan-to-obtain-our-posterior-distribution" title="Permalink to this heading">#</a></h2>
<p>We already designed our Bayesian model. Now it is time to code it in <code class="docutils literal notranslate"><span class="pre">Stan</span></code>. Recall that with a dataset containing <span class="math notranslate nohighlight">\(n\)</span> observations (i.e., rows in <code class="docutils literal notranslate"><span class="pre">bikeshare_data</span></code> which is our training set size), for the <span class="math notranslate nohighlight">\(i\)</span>th observation <span class="math notranslate nohighlight">\((i = 1, \dots, n)\)</span> with temperature <span class="math notranslate nohighlight">\(t_i\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
\text{likelihood:} \qquad R_i \mid a_{w_i}, l_{w_i} \mathop\sim^\text{ind} \text{Poisson}\big(\lambda_{w_i}(t_i)\big) \\ \text{where} \quad \lambda_{w_i}(t_i) =  \log\{1+\exp[a_{w_i} (t_i - l_{w_i})]\} \quad \text{and} \quad w_i \in \{1, 2, 3\} \\
\text{priors:} \quad a_{w_i} \sim \mathrm{Gamma}(k = 1, \theta = 1) \\
\qquad l_{w_i} \sim \mathcal{N}(\mu = 0, \sigma^2 = 15^2).
\end{align*}\end{split}\]</div>
<section id="coding-the-model">
<h3>5.1. Coding the Model<a class="headerlink" href="#coding-the-model" title="Permalink to this heading">#</a></h3>
<p>Recall <code class="docutils literal notranslate"><span class="pre">Stan</span></code> has a <strong>block structure</strong>. Therefore, we will use the following blocks:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">data</span></code>: The <strong>inputs</strong> needed to run the Bayesian model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">parameters</span></code>: The <strong>parameters</strong> to be sampled <strong>for our posterior analysis</strong> (<span class="math notranslate nohighlight">\(a_w\)</span> and <span class="math notranslate nohighlight">\(l_w\)</span> for <span class="math notranslate nohighlight">\(w \in \{1, 2, 3\}\)</span>). Their <strong>approximate posterior distributions</strong> will allow us to establish the extent to which temperature and mean bike ride count are related across different categories of weather (<strong>this is Bayesian inference!</strong>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model</span></code>: Our Bayesian model.</p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p><code class="docutils literal notranslate"><span class="pre">Stan</span></code> needs to know every single detail of our <code class="docutils literal notranslate"><span class="pre">data</span></code> and generative <code class="docutils literal notranslate"><span class="pre">model</span></code> (object types, sizes, loops, etc.).</p>
</div>
<p>Unlike the <code class="docutils literal notranslate"><span class="pre">R</span></code> markdown, we do not have a <code class="docutils literal notranslate"><span class="pre">Stan</span></code> cell in Jupyter notebook/lab. Hence, we need to code our <code class="docutils literal notranslate"><span class="pre">bikeshare_model</span></code> as a string.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_model</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s">&quot;data {                          </span>
<span class="s">int&lt;lower=1&gt; number_weather_cat;      // integer to indicate how many weather categories we have</span>
<span class="s">int&lt;lower=1&gt; n;      // how many rows we have in bikeshare_data                               </span>
<span class="s">vector[n] temp;      // column bikeshare_data$temp of real type</span>
<span class="s">int&lt;lower=1&gt; weather[n];      // column bikeshare_data$weather as integer                      </span>
<span class="s">int&lt;lower=0&gt; ride_count[n];      // column bikeshare_data$ride_count as integer                    </span>
<span class="s">}</span>
<span class="s">parameters {</span>
<span class="s">vector&lt;lower=0&gt;[number_weather_cat] a;      // a vector of size number_weather_cat for a_w</span>
<span class="s">vector[number_weather_cat] l;      // a real-type vector of size number_weather_cat for l_w</span>
<span class="s">}</span>
<span class="s">model {</span>
<span class="s">for (j in 1:number_weather_cat){      // we have three PAIRS of priors, i.e., one PAIR per weather category</span>
<span class="s">  a[j] ~ gamma(1, 1);</span>
<span class="s">  l[j] ~ normal(0, 15);</span>
<span class="s">}</span>
<span class="s">for (i in 1:n){      // building our likelihood</span>
<span class="s">  int w_index = weather[i];      // auxiliary variable for the ith weather category</span>
<span class="s">  ride_count[i] ~ poisson(log(1 + exp(a[w_index] * (temp[i] - l[w_index]))));</span>
<span class="s">}</span>
<span class="s">}&quot;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mcmc-simulation">
<h3>5.2. MCMC Simulation<a class="headerlink" href="#mcmc-simulation" title="Permalink to this heading">#</a></h3>
<p>Next, we create a <strong>dictionary</strong> with all the <code class="docutils literal notranslate"><span class="pre">data</span></code> variables we need to pass into <code class="docutils literal notranslate"><span class="pre">Stan</span></code> as a <code class="docutils literal notranslate"><span class="pre">list()</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">bikeshare_dictionary</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span>
<span class="w">  </span><span class="n">number_weather_cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span>
<span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">nrow</span><span class="p">(</span><span class="n">bikeshare_data</span><span class="p">),</span><span class="w"> </span>
<span class="w">  </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bikeshare_data</span><span class="o">$</span><span class="n">temp</span><span class="p">,</span>
<span class="w">  </span><span class="n">weather</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">bikeshare_data</span><span class="o">$</span><span class="n">weather</span><span class="p">),</span>
<span class="w">  </span><span class="n">ride_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">bikeshare_data</span><span class="o">$</span><span class="n">ride_count</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>We have not compiled <code class="docutils literal notranslate"><span class="pre">bikeshare_model</span></code>.</strong> Hence, we cannot use <code class="docutils literal notranslate"><span class="pre">sampling()</span></code> directly but <code class="docutils literal notranslate"><span class="pre">stan()</span></code> as in the cell below. Note the MCMC arguments are provided as in <code class="docutils literal notranslate"><span class="pre">sampling()</span></code>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">chains</span></code>: <strong>How many times</strong> we want to run the Bayesian simulation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">iter</span></code>: The <strong>number of approximate posterior sampled sets of <code class="docutils literal notranslate"><span class="pre">parameters</span></code></strong> we want (including <strong>burn-in</strong>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">warmup</span></code>: The <strong>burn-in</strong> period.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">thin</span></code>: Number of samples to <strong>skip</strong> between each draw.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">seed</span></code>: Reproducibility seed.</p></li>
</ul>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">posterior_bikeshare</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">stan</span><span class="p">(</span>
<span class="w">  </span><span class="n">model_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bikeshare_model</span><span class="p">,</span>
<span class="w">  </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bikeshare_dictionary</span><span class="p">,</span>
<span class="w">  </span><span class="n">chains</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span>
<span class="w">  </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20000</span><span class="p">,</span>
<span class="w">  </span><span class="n">warmup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2000</span><span class="p">,</span>
<span class="w">  </span><span class="n">thin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40</span><span class="p">,</span>
<span class="w">  </span><span class="n">seed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">553</span><span class="p">,</span>
<span class="w">  </span><span class="n">verbose</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span>
<span class="w">  </span><span class="n">algorithm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;NUTS&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TRANSLATING MODEL &#39;&#39; FROM Stan CODE TO C++ CODE NOW.
OS: aarch64, darwin20; rstan: 2.32.6; Rcpp: 1.0.12; inline: 0.3.19 
 &gt;&gt; setting environment variables: 
PKG_LIBS =  &#39;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/rstan/lib//libStanServices.a&#39; -L&#39;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/lib/&#39; -lStanHeaders -L&#39;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppParallel/lib/&#39; -ltbb -L/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppParallel/lib -ltbb -ltbbmalloc
PKG_CPPFLAGS =   -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/Rcpp/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppEigen/include/unsupported&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/BH/include&quot; -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/src/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/RcppParallel/include/&quot;  -I&quot;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/rstan/include&quot; -DEIGEN_NO_DEBUG  -DBOOST_DISABLE_ASSERTS  -DBOOST_PENDING_INTEGER_LOG2_HPP  -DSTAN_THREADS  -DUSE_STANC3 -DSTRICT_R_HEADERS  -DBOOST_PHOENIX_NO_VARIADIC_EXPRESSION  -D_HAS_AUTO_PTR_ETC=0  -include &#39;/Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/StanHeaders/include/stan/math/prim/fun/Eigen.hpp&#39;  -D_REENTRANT -DRCPP_PARALLEL_USE_TBB=1 
 &gt;&gt; Program source :

   1 : 
   2 : // includes from the plugin
   3 : // [[Rcpp::plugins(cpp14)]]
   4 : 
   5 : 
   6 : // user includes
   7 : #include &lt;Rcpp.h&gt;
   8 : using namespace Rcpp;
   9 : #ifndef MODELS_HPP
  10 : #define MODELS_HPP
  11 : #define STAN__SERVICES__COMMAND_HPP
  12 : #include &lt;rstan/rstaninc.hpp&gt;
  13 : #ifndef USE_STANC3
  14 : #define USE_STANC3
  15 : #endif
  16 : // Code generated by stanc v2.32.2
  17 : #include &lt;stan/model/model_header.hpp&gt;
  18 : namespace model18558745e4a24__namespace {
  19 : using stan::model::model_base_crtp;
  20 : using namespace stan::math;
  21 : stan::math::profile_map profiles__;
  22 : static constexpr std::array&lt;const char*, 21&gt; locations_array__ =
  23 :   {&quot; (found before start of program)&quot;,
  24 :   &quot; (in &#39;anon_model&#39;, line 9, column 0 to column 38)&quot;,
  25 :   &quot; (in &#39;anon_model&#39;, line 10, column 0 to column 29)&quot;,
  26 :   &quot; (in &#39;anon_model&#39;, line 14, column 2 to column 21)&quot;,
  27 :   &quot; (in &#39;anon_model&#39;, line 15, column 2 to column 23)&quot;,
  28 :   &quot; (in &#39;anon_model&#39;, line 13, column 31 to line 16, column 1)&quot;,
  29 :   &quot; (in &#39;anon_model&#39;, line 13, column 0 to line 16, column 1)&quot;,
  30 :   &quot; (in &#39;anon_model&#39;, line 18, column 2 to column 27)&quot;,
  31 :   &quot; (in &#39;anon_model&#39;, line 19, column 2 to column 77)&quot;,
  32 :   &quot; (in &#39;anon_model&#39;, line 17, column 14 to line 20, column 1)&quot;,
  33 :   &quot; (in &#39;anon_model&#39;, line 17, column 0 to line 20, column 1)&quot;,
  34 :   &quot; (in &#39;anon_model&#39;, line 2, column 0 to column 32)&quot;,
  35 :   &quot; (in &#39;anon_model&#39;, line 3, column 0 to column 15)&quot;,
  36 :   &quot; (in &#39;anon_model&#39;, line 4, column 7 to column 8)&quot;,
  37 :   &quot; (in &#39;anon_model&#39;, line 4, column 0 to column 15)&quot;,
  38 :   &quot; (in &#39;anon_model&#39;, line 5, column 21 to column 22)&quot;,
  39 :   &quot; (in &#39;anon_model&#39;, line 5, column 0 to column 24)&quot;,
  40 :   &quot; (in &#39;anon_model&#39;, line 6, column 24 to column 25)&quot;,
  41 :   &quot; (in &#39;anon_model&#39;, line 6, column 0 to column 27)&quot;,
  42 :   &quot; (in &#39;anon_model&#39;, line 9, column 16 to column 34)&quot;,
  43 :   &quot; (in &#39;anon_model&#39;, line 10, column 7 to column 25)&quot;};
  44 : class model18558745e4a24_ final : public model_base_crtp&lt;model18558745e4a24_&gt; {
  45 : private:
  46 :   int number_weather_cat;
  47 :   int n;
  48 :   Eigen::Matrix&lt;double,-1,1&gt; temp_data__;
  49 :   std::vector&lt;int&gt; weather;
  50 :   std::vector&lt;int&gt; ride_count;
  51 :   Eigen::Map&lt;Eigen::Matrix&lt;double,-1,1&gt;&gt; temp{nullptr, 0};
  52 : public:
  53 :   ~model18558745e4a24_() {}
  54 :   model18558745e4a24_(stan::io::var_context&amp; context__, unsigned int
  55 :                       random_seed__ = 0, std::ostream* pstream__ = nullptr)
  56 :       : model_base_crtp(0) {
  57 :     int current_statement__ = 0;
  58 :     using local_scalar_t__ = double;
  59 :     boost::ecuyer1988 base_rng__ =
  60 :       stan::services::util::create_rng(random_seed__, 0);
  61 :     // suppress unused var warning
  62 :     (void) base_rng__;
  63 :     static constexpr const char* function__ =
  64 :       &quot;model18558745e4a24__namespace::model18558745e4a24_&quot;;
  65 :     // suppress unused var warning
  66 :     (void) function__;
  67 :     local_scalar_t__ DUMMY_VAR__(std::numeric_limits&lt;double&gt;::quiet_NaN());
  68 :     // suppress unused var warning
  69 :     (void) DUMMY_VAR__;
  70 :     try {
  71 :       int pos__ = std::numeric_limits&lt;int&gt;::min();
  72 :       pos__ = 1;
  73 :       current_statement__ = 11;
  74 :       context__.validate_dims(&quot;data initialization&quot;, &quot;number_weather_cat&quot;,
  75 :         &quot;int&quot;, std::vector&lt;size_t&gt;{});
  76 :       number_weather_cat = std::numeric_limits&lt;int&gt;::min();
  77 :       current_statement__ = 11;
  78 :       number_weather_cat = context__.vals_i(&quot;number_weather_cat&quot;)[(1 - 1)];
  79 :       current_statement__ = 11;
  80 :       stan::math::check_greater_or_equal(function__, &quot;number_weather_cat&quot;,
  81 :         number_weather_cat, 1);
  82 :       current_statement__ = 12;
  83 :       context__.validate_dims(&quot;data initialization&quot;, &quot;n&quot;, &quot;int&quot;,
  84 :         std::vector&lt;size_t&gt;{});
  85 :       n = std::numeric_limits&lt;int&gt;::min();
  86 :       current_statement__ = 12;
  87 :       n = context__.vals_i(&quot;n&quot;)[(1 - 1)];
  88 :       current_statement__ = 12;
  89 :       stan::math::check_greater_or_equal(function__, &quot;n&quot;, n, 1);
  90 :       current_statement__ = 13;
  91 :       stan::math::validate_non_negative_index(&quot;temp&quot;, &quot;n&quot;, n);
  92 :       current_statement__ = 14;
  93 :       context__.validate_dims(&quot;data initialization&quot;, &quot;temp&quot;, &quot;double&quot;,
  94 :         std::vector&lt;size_t&gt;{static_cast&lt;size_t&gt;(n)});
  95 :       temp_data__ = Eigen::Matrix&lt;double,-1,1&gt;::Constant(n,
  96 :                       std::numeric_limits&lt;double&gt;::quiet_NaN());
  97 :       new (&amp;temp) Eigen::Map&lt;Eigen::Matrix&lt;double,-1,1&gt;&gt;(temp_data__.data(),
  98 :         n);
  99 :       {
 100 :         std::vector&lt;local_scalar_t__&gt; temp_flat__;
 101 :         current_statement__ = 14;
 102 :         temp_flat__ = context__.vals_r(&quot;temp&quot;);
 103 :         current_statement__ = 14;
 104 :         pos__ = 1;
 105 :         current_statement__ = 14;
 106 :         for (int sym1__ = 1; sym1__ &lt;= n; ++sym1__) {
 107 :           current_statement__ = 14;
 108 :           stan::model::assign(temp, temp_flat__[(pos__ - 1)],
 109 :             &quot;assigning variable temp&quot;, stan::model::index_uni(sym1__));
 110 :           current_statement__ = 14;
 111 :           pos__ = (pos__ + 1);
 112 :         }
 113 :       }
 114 :       current_statement__ = 15;
 115 :       stan::math::validate_non_negative_index(&quot;weather&quot;, &quot;n&quot;, n);
 116 :       current_statement__ = 16;
 117 :       context__.validate_dims(&quot;data initialization&quot;, &quot;weather&quot;, &quot;int&quot;,
 118 :         std::vector&lt;size_t&gt;{static_cast&lt;size_t&gt;(n)});
 119 :       weather = std::vector&lt;int&gt;(n, std::numeric_limits&lt;int&gt;::min());
 120 :       current_statement__ = 16;
 121 :       weather = context__.vals_i(&quot;weather&quot;);
 122 :       current_statement__ = 16;
 123 :       stan::math::check_greater_or_equal(function__, &quot;weather&quot;, weather, 1);
 124 :       current_statement__ = 17;
 125 :       stan::math::validate_non_negative_index(&quot;ride_count&quot;, &quot;n&quot;, n);
 126 :       current_statement__ = 18;
 127 :       context__.validate_dims(&quot;data initialization&quot;, &quot;ride_count&quot;, &quot;int&quot;,
 128 :         std::vector&lt;size_t&gt;{static_cast&lt;size_t&gt;(n)});
 129 :       ride_count = std::vector&lt;int&gt;(n, std::numeric_limits&lt;int&gt;::min());
 130 :       current_statement__ = 18;
 131 :       ride_count = context__.vals_i(&quot;ride_count&quot;);
 132 :       current_statement__ = 18;
 133 :       stan::math::check_greater_or_equal(function__, &quot;ride_count&quot;,
 134 :         ride_count, 0);
 135 :       current_statement__ = 19;
 136 :       stan::math::validate_non_negative_index(&quot;a&quot;, &quot;number_weather_cat&quot;,
 137 :         number_weather_cat);
 138 :       current_statement__ = 20;
 139 :       stan::math::validate_non_negative_index(&quot;l&quot;, &quot;number_weather_cat&quot;,
 140 :         number_weather_cat);
 141 :     } catch (const std::exception&amp; e) {
 142 :       stan::lang::rethrow_located(e, locations_array__[current_statement__]);
 143 :     }
 144 :     num_params_r__ = number_weather_cat + number_weather_cat;
 145 :   }
 146 :   inline std::string model_name() const final {
 147 :     return &quot;model18558745e4a24_&quot;;
 148 :   }
 149 :   inline std::vector&lt;std::string&gt; model_compile_info() const noexcept {
 150 :     return std::vector&lt;std::string&gt;{&quot;stanc_version = stanc3 v2.32.2&quot;,
 151 :              &quot;stancflags = --&quot;};
 152 :   }
 153 :   template &lt;bool propto__, bool jacobian__, typename VecR, typename VecI,
 154 :             stan::require_vector_like_t&lt;VecR&gt;* = nullptr,
 155 :             stan::require_vector_like_vt&lt;std::is_integral, VecI&gt;* = nullptr&gt;
 156 :   inline stan::scalar_type_t&lt;VecR&gt;
 157 :   log_prob_impl(VecR&amp; params_r__, VecI&amp; params_i__, std::ostream*
 158 :                 pstream__ = nullptr) const {
 159 :     using T__ = stan::scalar_type_t&lt;VecR&gt;;
 160 :     using local_scalar_t__ = T__;
 161 :     T__ lp__(0.0);
 162 :     stan::math::accumulator&lt;T__&gt; lp_accum__;
 163 :     stan::io::deserializer&lt;local_scalar_t__&gt; in__(params_r__, params_i__);
 164 :     int current_statement__ = 0;
 165 :     local_scalar_t__ DUMMY_VAR__(std::numeric_limits&lt;double&gt;::quiet_NaN());
 166 :     // suppress unused var warning
 167 :     (void) DUMMY_VAR__;
 168 :     static constexpr const char* function__ =
 169 :       &quot;model18558745e4a24__namespace::log_prob&quot;;
 170 :     // suppress unused var warning
 171 :     (void) function__;
 172 :     try {
 173 :       Eigen::Matrix&lt;local_scalar_t__,-1,1&gt; a =
 174 :         Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;::Constant(number_weather_cat,
 175 :           DUMMY_VAR__);
 176 :       current_statement__ = 1;
 177 :       a = in__.template read_constrain_lb&lt;
 178 :             Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;, jacobian__&gt;(0, lp__,
 179 :             number_weather_cat);
 180 :       Eigen::Matrix&lt;local_scalar_t__,-1,1&gt; l =
 181 :         Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;::Constant(number_weather_cat,
 182 :           DUMMY_VAR__);
 183 :       current_statement__ = 2;
 184 :       l = in__.template read&lt;
 185 :             Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;&gt;(number_weather_cat);
 186 :       {
 187 :         current_statement__ = 6;
 188 :         for (int j = 1; j &lt;= number_weather_cat; ++j) {
 189 :           current_statement__ = 3;
 190 :           lp_accum__.add(stan::math::gamma_lpdf&lt;propto__&gt;(
 191 :                            stan::model::rvalue(a, &quot;a&quot;,
 192 :                              stan::model::index_uni(j)), 1, 1));
 193 :           current_statement__ = 4;
 194 :           lp_accum__.add(stan::math::normal_lpdf&lt;propto__&gt;(
 195 :                            stan::model::rvalue(l, &quot;l&quot;,
 196 :                              stan::model::index_uni(j)), 0, 15));
 197 :         }
 198 :         current_statement__ = 10;
 199 :         for (int i = 1; i &lt;= n; ++i) {
 200 :           int w_index = std::numeric_limits&lt;int&gt;::min();
 201 :           current_statement__ = 7;
 202 :           w_index = stan::model::rvalue(weather, &quot;weather&quot;,
 203 :                       stan::model::index_uni(i));
 204 :           current_statement__ = 8;
 205 :           lp_accum__.add(stan::math::poisson_lpmf&lt;propto__&gt;(
 206 :                            stan::model::rvalue(ride_count, &quot;ride_count&quot;,
 207 :                              stan::model::index_uni(i)),
 208 :                            stan::math::log((1 +
 209 :                              stan::math::exp(
 210 :                                (stan::model::rvalue(a, &quot;a&quot;,
 211 :                                   stan::model::index_uni(w_index)) *
 212 :                                (stan::model::rvalue(temp, &quot;temp&quot;,
 213 :                                   stan::model::index_uni(i)) -
 214 :                                stan::model::rvalue(l, &quot;l&quot;,
 215 :                                  stan::model::index_uni(w_index)))))))));
 216 :         }
 217 :       }
 218 :     } catch (const std::exception&amp; e) {
 219 :       stan::lang::rethrow_located(e, locations_array__[current_statement__]);
 220 :     }
 221 :     lp_accum__.add(lp__);
 222 :     return lp_accum__.sum();
 223 :   }
 224 :   template &lt;typename RNG, typename VecR, typename VecI, typename VecVar,
 225 :             stan::require_vector_like_vt&lt;std::is_floating_point,
 226 :             VecR&gt;* = nullptr, stan::require_vector_like_vt&lt;std::is_integral,
 227 :             VecI&gt;* = nullptr, stan::require_vector_vt&lt;std::is_floating_point,
 228 :             VecVar&gt;* = nullptr&gt;
 229 :   inline void
 230 :   write_array_impl(RNG&amp; base_rng__, VecR&amp; params_r__, VecI&amp; params_i__,
 231 :                    VecVar&amp; vars__, const bool
 232 :                    emit_transformed_parameters__ = true, const bool
 233 :                    emit_generated_quantities__ = true, std::ostream*
 234 :                    pstream__ = nullptr) const {
 235 :     using local_scalar_t__ = double;
 236 :     stan::io::deserializer&lt;local_scalar_t__&gt; in__(params_r__, params_i__);
 237 :     stan::io::serializer&lt;local_scalar_t__&gt; out__(vars__);
 238 :     static constexpr bool propto__ = true;
 239 :     // suppress unused var warning
 240 :     (void) propto__;
 241 :     double lp__ = 0.0;
 242 :     // suppress unused var warning
 243 :     (void) lp__;
 244 :     int current_statement__ = 0;
 245 :     stan::math::accumulator&lt;double&gt; lp_accum__;
 246 :     local_scalar_t__ DUMMY_VAR__(std::numeric_limits&lt;double&gt;::quiet_NaN());
 247 :     // suppress unused var warning
 248 :     (void) DUMMY_VAR__;
 249 :     constexpr bool jacobian__ = false;
 250 :     static constexpr const char* function__ =
 251 :       &quot;model18558745e4a24__namespace::write_array&quot;;
 252 :     // suppress unused var warning
 253 :     (void) function__;
 254 :     try {
 255 :       Eigen::Matrix&lt;double,-1,1&gt; a =
 256 :         Eigen::Matrix&lt;double,-1,1&gt;::Constant(number_weather_cat,
 257 :           std::numeric_limits&lt;double&gt;::quiet_NaN());
 258 :       current_statement__ = 1;
 259 :       a = in__.template read_constrain_lb&lt;
 260 :             Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;, jacobian__&gt;(0, lp__,
 261 :             number_weather_cat);
 262 :       Eigen::Matrix&lt;double,-1,1&gt; l =
 263 :         Eigen::Matrix&lt;double,-1,1&gt;::Constant(number_weather_cat,
 264 :           std::numeric_limits&lt;double&gt;::quiet_NaN());
 265 :       current_statement__ = 2;
 266 :       l = in__.template read&lt;
 267 :             Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;&gt;(number_weather_cat);
 268 :       out__.write(a);
 269 :       out__.write(l);
 270 :       if (stan::math::logical_negation(
 271 :             (stan::math::primitive_value(emit_transformed_parameters__) ||
 272 :             stan::math::primitive_value(emit_generated_quantities__)))) {
 273 :         return ;
 274 :       }
 275 :       if (stan::math::logical_negation(emit_generated_quantities__)) {
 276 :         return ;
 277 :       }
 278 :     } catch (const std::exception&amp; e) {
 279 :       stan::lang::rethrow_located(e, locations_array__[current_statement__]);
 280 :     }
 281 :   }
 282 :   template &lt;typename VecVar, typename VecI,
 283 :             stan::require_vector_t&lt;VecVar&gt;* = nullptr,
 284 :             stan::require_vector_like_vt&lt;std::is_integral, VecI&gt;* = nullptr&gt;
 285 :   inline void
 286 :   unconstrain_array_impl(const VecVar&amp; params_r__, const VecI&amp; params_i__,
 287 :                          VecVar&amp; vars__, std::ostream* pstream__ = nullptr) const {
 288 :     using local_scalar_t__ = double;
 289 :     stan::io::deserializer&lt;local_scalar_t__&gt; in__(params_r__, params_i__);
 290 :     stan::io::serializer&lt;local_scalar_t__&gt; out__(vars__);
 291 :     int current_statement__ = 0;
 292 :     local_scalar_t__ DUMMY_VAR__(std::numeric_limits&lt;double&gt;::quiet_NaN());
 293 :     // suppress unused var warning
 294 :     (void) DUMMY_VAR__;
 295 :     try {
 296 :       int pos__ = std::numeric_limits&lt;int&gt;::min();
 297 :       pos__ = 1;
 298 :       Eigen::Matrix&lt;local_scalar_t__,-1,1&gt; a =
 299 :         Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;::Constant(number_weather_cat,
 300 :           DUMMY_VAR__);
 301 :       current_statement__ = 1;
 302 :       stan::model::assign(a,
 303 :         in__.read&lt;Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;&gt;(number_weather_cat),
 304 :         &quot;assigning variable a&quot;);
 305 :       out__.write_free_lb(0, a);
 306 :       Eigen::Matrix&lt;local_scalar_t__,-1,1&gt; l =
 307 :         Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;::Constant(number_weather_cat,
 308 :           DUMMY_VAR__);
 309 :       current_statement__ = 2;
 310 :       stan::model::assign(l,
 311 :         in__.read&lt;Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;&gt;(number_weather_cat),
 312 :         &quot;assigning variable l&quot;);
 313 :       out__.write(l);
 314 :     } catch (const std::exception&amp; e) {
 315 :       stan::lang::rethrow_located(e, locations_array__[current_statement__]);
 316 :     }
 317 :   }
 318 :   template &lt;typename VecVar, stan::require_vector_t&lt;VecVar&gt;* = nullptr&gt;
 319 :   inline void
 320 :   transform_inits_impl(const stan::io::var_context&amp; context__, VecVar&amp;
 321 :                        vars__, std::ostream* pstream__ = nullptr) const {
 322 :     using local_scalar_t__ = double;
 323 :     stan::io::serializer&lt;local_scalar_t__&gt; out__(vars__);
 324 :     int current_statement__ = 0;
 325 :     local_scalar_t__ DUMMY_VAR__(std::numeric_limits&lt;double&gt;::quiet_NaN());
 326 :     // suppress unused var warning
 327 :     (void) DUMMY_VAR__;
 328 :     try {
 329 :       current_statement__ = 1;
 330 :       context__.validate_dims(&quot;parameter initialization&quot;, &quot;a&quot;, &quot;double&quot;,
 331 :         std::vector&lt;size_t&gt;{static_cast&lt;size_t&gt;(number_weather_cat)});
 332 :       current_statement__ = 2;
 333 :       context__.validate_dims(&quot;parameter initialization&quot;, &quot;l&quot;, &quot;double&quot;,
 334 :         std::vector&lt;size_t&gt;{static_cast&lt;size_t&gt;(number_weather_cat)});
 335 :       int pos__ = std::numeric_limits&lt;int&gt;::min();
 336 :       pos__ = 1;
 337 :       Eigen::Matrix&lt;local_scalar_t__,-1,1&gt; a =
 338 :         Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;::Constant(number_weather_cat,
 339 :           DUMMY_VAR__);
 340 :       {
 341 :         std::vector&lt;local_scalar_t__&gt; a_flat__;
 342 :         current_statement__ = 1;
 343 :         a_flat__ = context__.vals_r(&quot;a&quot;);
 344 :         current_statement__ = 1;
 345 :         pos__ = 1;
 346 :         current_statement__ = 1;
 347 :         for (int sym1__ = 1; sym1__ &lt;= number_weather_cat; ++sym1__) {
 348 :           current_statement__ = 1;
 349 :           stan::model::assign(a, a_flat__[(pos__ - 1)],
 350 :             &quot;assigning variable a&quot;, stan::model::index_uni(sym1__));
 351 :           current_statement__ = 1;
 352 :           pos__ = (pos__ + 1);
 353 :         }
 354 :       }
 355 :       out__.write_free_lb(0, a);
 356 :       Eigen::Matrix&lt;local_scalar_t__,-1,1&gt; l =
 357 :         Eigen::Matrix&lt;local_scalar_t__,-1,1&gt;::Constant(number_weather_cat,
 358 :           DUMMY_VAR__);
 359 :       {
 360 :         std::vector&lt;local_scalar_t__&gt; l_flat__;
 361 :         current_statement__ = 2;
 362 :         l_flat__ = context__.vals_r(&quot;l&quot;);
 363 :         current_statement__ = 2;
 364 :         pos__ = 1;
 365 :         current_statement__ = 2;
 366 :         for (int sym1__ = 1; sym1__ &lt;= number_weather_cat; ++sym1__) {
 367 :           current_statement__ = 2;
 368 :           stan::model::assign(l, l_flat__[(pos__ - 1)],
 369 :             &quot;assigning variable l&quot;, stan::model::index_uni(sym1__));
 370 :           current_statement__ = 2;
 371 :           pos__ = (pos__ + 1);
 372 :         }
 373 :       }
 374 :       out__.write(l);
 375 :     } catch (const std::exception&amp; e) {
 376 :       stan::lang::rethrow_located(e, locations_array__[current_statement__]);
 377 :     }
 378 :   }
 379 :   inline void
 380 :   get_param_names(std::vector&lt;std::string&gt;&amp; names__, const bool
 381 :                   emit_transformed_parameters__ = true, const bool
 382 :                   emit_generated_quantities__ = true) const {
 383 :     names__ = std::vector&lt;std::string&gt;{&quot;a&quot;, &quot;l&quot;};
 384 :     if (emit_transformed_parameters__) {}
 385 :     if (emit_generated_quantities__) {}
 386 :   }
 387 :   inline void
 388 :   get_dims(std::vector&lt;std::vector&lt;size_t&gt;&gt;&amp; dimss__, const bool
 389 :            emit_transformed_parameters__ = true, const bool
 390 :            emit_generated_quantities__ = true) const {
 391 :     dimss__ = std::vector&lt;std::vector&lt;size_t&gt;&gt;{std::vector&lt;size_t&gt;{static_cast&lt;
 392 :                                                                     size_t&gt;(
 393 :                                                                     number_weather_cat)},
 394 :                 std::vector&lt;size_t&gt;{static_cast&lt;size_t&gt;(number_weather_cat)}};
 395 :     if (emit_transformed_parameters__) {}
 396 :     if (emit_generated_quantities__) {}
 397 :   }
 398 :   inline void
 399 :   constrained_param_names(std::vector&lt;std::string&gt;&amp; param_names__, bool
 400 :                           emit_transformed_parameters__ = true, bool
 401 :                           emit_generated_quantities__ = true) const final {
 402 :     for (int sym1__ = 1; sym1__ &lt;= number_weather_cat; ++sym1__) {
 403 :       param_names__.emplace_back(std::string() + &quot;a&quot; + &#39;.&#39; +
 404 :         std::to_string(sym1__));
 405 :     }
 406 :     for (int sym1__ = 1; sym1__ &lt;= number_weather_cat; ++sym1__) {
 407 :       param_names__.emplace_back(std::string() + &quot;l&quot; + &#39;.&#39; +
 408 :         std::to_string(sym1__));
 409 :     }
 410 :     if (emit_transformed_parameters__) {}
 411 :     if (emit_generated_quantities__) {}
 412 :   }
 413 :   inline void
 414 :   unconstrained_param_names(std::vector&lt;std::string&gt;&amp; param_names__, bool
 415 :                             emit_transformed_parameters__ = true, bool
 416 :                             emit_generated_quantities__ = true) const final {
 417 :     for (int sym1__ = 1; sym1__ &lt;= number_weather_cat; ++sym1__) {
 418 :       param_names__.emplace_back(std::string() + &quot;a&quot; + &#39;.&#39; +
 419 :         std::to_string(sym1__));
 420 :     }
 421 :     for (int sym1__ = 1; sym1__ &lt;= number_weather_cat; ++sym1__) {
 422 :       param_names__.emplace_back(std::string() + &quot;l&quot; + &#39;.&#39; +
 423 :         std::to_string(sym1__));
 424 :     }
 425 :     if (emit_transformed_parameters__) {}
 426 :     if (emit_generated_quantities__) {}
 427 :   }
 428 :   inline std::string get_constrained_sizedtypes() const {
 429 :     return std::string(&quot;[{\&quot;name\&quot;:\&quot;a\&quot;,\&quot;type\&quot;:{\&quot;name\&quot;:\&quot;vector\&quot;,\&quot;length\&quot;:&quot; + std::to_string(number_weather_cat) + &quot;},\&quot;block\&quot;:\&quot;parameters\&quot;},{\&quot;name\&quot;:\&quot;l\&quot;,\&quot;type\&quot;:{\&quot;name\&quot;:\&quot;vector\&quot;,\&quot;length\&quot;:&quot; + std::to_string(number_weather_cat) + &quot;},\&quot;block\&quot;:\&quot;parameters\&quot;}]&quot;);
 430 :   }
 431 :   inline std::string get_unconstrained_sizedtypes() const {
 432 :     return std::string(&quot;[{\&quot;name\&quot;:\&quot;a\&quot;,\&quot;type\&quot;:{\&quot;name\&quot;:\&quot;vector\&quot;,\&quot;length\&quot;:&quot; + std::to_string(number_weather_cat) + &quot;},\&quot;block\&quot;:\&quot;parameters\&quot;},{\&quot;name\&quot;:\&quot;l\&quot;,\&quot;type\&quot;:{\&quot;name\&quot;:\&quot;vector\&quot;,\&quot;length\&quot;:&quot; + std::to_string(number_weather_cat) + &quot;},\&quot;block\&quot;:\&quot;parameters\&quot;}]&quot;);
 433 :   }
 434 :   // Begin method overload boilerplate
 435 :   template &lt;typename RNG&gt; inline void
 436 :   write_array(RNG&amp; base_rng, Eigen::Matrix&lt;double,-1,1&gt;&amp; params_r,
 437 :               Eigen::Matrix&lt;double,-1,1&gt;&amp; vars, const bool
 438 :               emit_transformed_parameters = true, const bool
 439 :               emit_generated_quantities = true, std::ostream*
 440 :               pstream = nullptr) const {
 441 :     const size_t num_params__ = (number_weather_cat + number_weather_cat);
 442 :     const size_t num_transformed = emit_transformed_parameters * (0);
 443 :     const size_t num_gen_quantities = emit_generated_quantities * (0);
 444 :     const size_t num_to_write = num_params__ + num_transformed +
 445 :       num_gen_quantities;
 446 :     std::vector&lt;int&gt; params_i;
 447 :     vars = Eigen::Matrix&lt;double,-1,1&gt;::Constant(num_to_write,
 448 :              std::numeric_limits&lt;double&gt;::quiet_NaN());
 449 :     write_array_impl(base_rng, params_r, params_i, vars,
 450 :       emit_transformed_parameters, emit_generated_quantities, pstream);
 451 :   }
 452 :   template &lt;typename RNG&gt; inline void
 453 :   write_array(RNG&amp; base_rng, std::vector&lt;double&gt;&amp; params_r, std::vector&lt;int&gt;&amp;
 454 :               params_i, std::vector&lt;double&gt;&amp; vars, bool
 455 :               emit_transformed_parameters = true, bool
 456 :               emit_generated_quantities = true, std::ostream*
 457 :               pstream = nullptr) const {
 458 :     const size_t num_params__ = (number_weather_cat + number_weather_cat);
 459 :     const size_t num_transformed = emit_transformed_parameters * (0);
 460 :     const size_t num_gen_quantities = emit_generated_quantities * (0);
 461 :     const size_t num_to_write = num_params__ + num_transformed +
 462 :       num_gen_quantities;
 463 :     vars = std::vector&lt;double&gt;(num_to_write,
 464 :              std::numeric_limits&lt;double&gt;::quiet_NaN());
 465 :     write_array_impl(base_rng, params_r, params_i, vars,
 466 :       emit_transformed_parameters, emit_generated_quantities, pstream);
 467 :   }
 468 :   template &lt;bool propto__, bool jacobian__, typename T_&gt; inline T_
 469 :   log_prob(Eigen::Matrix&lt;T_,-1,1&gt;&amp; params_r, std::ostream* pstream = nullptr) const {
 470 :     Eigen::Matrix&lt;int,-1,1&gt; params_i;
 471 :     return log_prob_impl&lt;propto__, jacobian__&gt;(params_r, params_i, pstream);
 472 :   }
 473 :   template &lt;bool propto__, bool jacobian__, typename T_&gt; inline T_
 474 :   log_prob(std::vector&lt;T_&gt;&amp; params_r, std::vector&lt;int&gt;&amp; params_i,
 475 :            std::ostream* pstream = nullptr) const {
 476 :     return log_prob_impl&lt;propto__, jacobian__&gt;(params_r, params_i, pstream);
 477 :   }
 478 :   inline void
 479 :   transform_inits(const stan::io::var_context&amp; context,
 480 :                   Eigen::Matrix&lt;double,-1,1&gt;&amp; params_r, std::ostream*
 481 :                   pstream = nullptr) const final {
 482 :     std::vector&lt;double&gt; params_r_vec(params_r.size());
 483 :     std::vector&lt;int&gt; params_i;
 484 :     transform_inits(context, params_i, params_r_vec, pstream);
 485 :     params_r = Eigen::Map&lt;Eigen::Matrix&lt;double,-1,1&gt;&gt;(params_r_vec.data(),
 486 :                  params_r_vec.size());
 487 :   }
 488 :   inline void
 489 :   transform_inits(const stan::io::var_context&amp; context, std::vector&lt;int&gt;&amp;
 490 :                   params_i, std::vector&lt;double&gt;&amp; vars, std::ostream*
 491 :                   pstream__ = nullptr) const {
 492 :     vars.resize(num_params_r__);
 493 :     transform_inits_impl(context, vars, pstream__);
 494 :   }
 495 :   inline void
 496 :   unconstrain_array(const std::vector&lt;double&gt;&amp; params_constrained,
 497 :                     std::vector&lt;double&gt;&amp; params_unconstrained, std::ostream*
 498 :                     pstream = nullptr) const {
 499 :     const std::vector&lt;int&gt; params_i;
 500 :     params_unconstrained = std::vector&lt;double&gt;(num_params_r__,
 501 :                              std::numeric_limits&lt;double&gt;::quiet_NaN());
 502 :     unconstrain_array_impl(params_constrained, params_i,
 503 :       params_unconstrained, pstream);
 504 :   }
 505 :   inline void
 506 :   unconstrain_array(const Eigen::Matrix&lt;double,-1,1&gt;&amp; params_constrained,
 507 :                     Eigen::Matrix&lt;double,-1,1&gt;&amp; params_unconstrained,
 508 :                     std::ostream* pstream = nullptr) const {
 509 :     const std::vector&lt;int&gt; params_i;
 510 :     params_unconstrained = Eigen::Matrix&lt;double,-1,1&gt;::Constant(num_params_r__,
 511 :                              std::numeric_limits&lt;double&gt;::quiet_NaN());
 512 :     unconstrain_array_impl(params_constrained, params_i,
 513 :       params_unconstrained, pstream);
 514 :   }
 515 : };
 516 : }
 517 : using stan_model = model18558745e4a24__namespace::model18558745e4a24_;
 518 : #ifndef USING_R
 519 : // Boilerplate
 520 : stan::model::model_base&amp;
 521 : new_model(stan::io::var_context&amp; data_context, unsigned int seed,
 522 :           std::ostream* msg_stream) {
 523 :   stan_model* m = new stan_model(data_context, seed, msg_stream);
 524 :   return *m;
 525 : }
 526 : stan::math::profile_map&amp; get_stan_profile_data() {
 527 :   return model18558745e4a24__namespace::profiles__;
 528 : }
 529 : #endif
 530 : #endif
 531 : 
 532 : RCPP_MODULE(stan_fit4model18558745e4a24__mod) {
 533 :   class_&lt;rstan::stan_fit&lt;stan_model, boost::random::ecuyer1988&gt; &gt;(
 534 :       &quot;stan_fit4model18558745e4a24_&quot;)
 535 : 
 536 :       .constructor&lt;SEXP, SEXP, SEXP&gt;()
 537 : 
 538 :       .method(
 539 :           &quot;call_sampler&quot;,
 540 :           &amp;rstan::stan_fit&lt;stan_model, boost::random::ecuyer1988&gt;::call_sampler)
 541 :       .method(
 542 :           &quot;param_names&quot;,
 543 :           &amp;rstan::stan_fit&lt;stan_model, boost::random::ecuyer1988&gt;::param_names)
 544 :       .method(&quot;param_names_oi&quot;,
 545 :               &amp;rstan::stan_fit&lt;stan_model,
 546 :                                boost::random::ecuyer1988&gt;::param_names_oi)
 547 :       .method(&quot;param_fnames_oi&quot;,
 548 :               &amp;rstan::stan_fit&lt;stan_model,
 549 :                                boost::random::ecuyer1988&gt;::param_fnames_oi)
 550 :       .method(
 551 :           &quot;param_dims&quot;,
 552 :           &amp;rstan::stan_fit&lt;stan_model, boost::random::ecuyer1988&gt;::param_dims)
 553 :       .method(&quot;param_dims_oi&quot;,
 554 :               &amp;rstan::stan_fit&lt;stan_model,
 555 :                                boost::random::ecuyer1988&gt;::param_dims_oi)
 556 :       .method(&quot;update_param_oi&quot;,
 557 :               &amp;rstan::stan_fit&lt;stan_model,
 558 :                                boost::random::ecuyer1988&gt;::update_param_oi)
 559 :       .method(&quot;param_oi_tidx&quot;,
 560 :               &amp;rstan::stan_fit&lt;stan_model,
 561 :                                boost::random::ecuyer1988&gt;::param_oi_tidx)
 562 :       .method(&quot;grad_log_prob&quot;,
 563 :               &amp;rstan::stan_fit&lt;stan_model,
 564 :                                boost::random::ecuyer1988&gt;::grad_log_prob)
 565 :       .method(&quot;log_prob&quot;,
 566 :               &amp;rstan::stan_fit&lt;stan_model, boost::random::ecuyer1988&gt;::log_prob)
 567 :       .method(&quot;unconstrain_pars&quot;,
 568 :               &amp;rstan::stan_fit&lt;stan_model,
 569 :                                boost::random::ecuyer1988&gt;::unconstrain_pars)
 570 :       .method(&quot;constrain_pars&quot;,
 571 :               &amp;rstan::stan_fit&lt;stan_model,
 572 :                                boost::random::ecuyer1988&gt;::constrain_pars)
 573 :       .method(
 574 :           &quot;num_pars_unconstrained&quot;,
 575 :           &amp;rstan::stan_fit&lt;stan_model,
 576 :                            boost::random::ecuyer1988&gt;::num_pars_unconstrained)
 577 :       .method(
 578 :           &quot;unconstrained_param_names&quot;,
 579 :           &amp;rstan::stan_fit&lt;
 580 :               stan_model, boost::random::ecuyer1988&gt;::unconstrained_param_names)
 581 :       .method(
 582 :           &quot;constrained_param_names&quot;,
 583 :           &amp;rstan::stan_fit&lt;stan_model,
 584 :                            boost::random::ecuyer1988&gt;::constrained_param_names)
 585 :       .method(&quot;standalone_gqs&quot;,
 586 :               &amp;rstan::stan_fit&lt;stan_model,
 587 :                                boost::random::ecuyer1988&gt;::standalone_gqs);
 588 : }
 589 : 
 590 : 
 591 : // declarations
 592 : extern &quot;C&quot; {
 593 : SEXP file185584cdbff65( ) ;
 594 : }
 595 : 
 596 : // definition
 597 : SEXP file185584cdbff65() {
 598 :  return Rcpp::wrap(&quot;anon_model&quot;);
 599 : }

CHECKING DATA AND PREPROCESSING FOR MODEL &#39;anon_model&#39; NOW.

COMPILING MODEL &#39;anon_model&#39; NOW.

STARTING SAMPLER FOR MODEL &#39;anon_model&#39; NOW.

SAMPLING FOR MODEL &#39;anon_model&#39; NOW (CHAIN 1).
Chain 1: 
Chain 1: Gradient evaluation took 0.001781 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 17.81 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Iteration:     1 / 20000 [  0%]  (Warmup)
Chain 1: Iteration:  2000 / 20000 [ 10%]  (Warmup)
Chain 1: Iteration:  2001 / 20000 [ 10%]  (Sampling)
Chain 1: Iteration:  4000 / 20000 [ 20%]  (Sampling)
Chain 1: Iteration:  6000 / 20000 [ 30%]  (Sampling)
Chain 1: Iteration:  8000 / 20000 [ 40%]  (Sampling)
Chain 1: Iteration: 10000 / 20000 [ 50%]  (Sampling)
Chain 1: Iteration: 12000 / 20000 [ 60%]  (Sampling)
Chain 1: Iteration: 14000 / 20000 [ 70%]  (Sampling)
Chain 1: Iteration: 16000 / 20000 [ 80%]  (Sampling)
Chain 1: Iteration: 18000 / 20000 [ 90%]  (Sampling)
Chain 1: Iteration: 20000 / 20000 [100%]  (Sampling)
Chain 1: 
Chain 1:  Elapsed Time: 63.03 seconds (Warm-up)
Chain 1:                507.332 seconds (Sampling)
Chain 1:                570.362 seconds (Total)
Chain 1: 
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="obtaining-visualizing-and-interpreting-the-posterior-results">
<h3>5.3. Obtaining, Visualizing, and Interpreting the Posterior Results<a class="headerlink" href="#obtaining-visualizing-and-interpreting-the-posterior-results" title="Permalink to this heading">#</a></h3>
<blockquote>
<div><p><strong><code class="docutils literal notranslate"><span class="pre">posterior_bikeshare</span></code> is our one-stop-shop!</strong></p>
</div></blockquote>
<p>We obtained a total of</p>
<div class="math notranslate nohighlight">
\[\frac{\texttt{iter} - \texttt{warmup}}{\texttt{thin}} = \frac{20000 - 2000}{40} = 450\]</div>
<p>approximate posterior samples <strong>to be summarized in our inferential conclusions</strong>.</p>
<p>You can obtain the <code class="docutils literal notranslate"><span class="pre">summary()</span></code> statistics for the object <code class="docutils literal notranslate"><span class="pre">posterior_bikeshare</span></code>. These statistics are drawn from the <strong>approximate joint posterior distribution</strong> of the <code class="docutils literal notranslate"><span class="pre">parameters</span></code> of interest: <span class="math notranslate nohighlight">\(a_1\)</span>, <span class="math notranslate nohighlight">\(a_2\)</span>, <span class="math notranslate nohighlight">\(a_3\)</span>, <span class="math notranslate nohighlight">\(l_1\)</span>, <span class="math notranslate nohighlight">\(l_2\)</span>, and <span class="math notranslate nohighlight">\(l_3\)</span>. Lower and upper bounds for the <strong>95% credible intervals</strong> are shown in columns <code class="docutils literal notranslate"><span class="pre">2.5%</span></code> and <code class="docutils literal notranslate"><span class="pre">97.5%</span></code>.</p>
<p>Metrics <code class="docutils literal notranslate"><span class="pre">se_mean</span></code> (Monte Carlo standard error), <code class="docutils literal notranslate"><span class="pre">n_eff</span></code> (effective sample size), and <code class="docutils literal notranslate"><span class="pre">Rhat</span></code> are model diagnostics (<strong>to be covered later on at the end of this course</strong>).</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><code class="docutils literal notranslate"><span class="pre">lp__</span></code> refers to the logarithm of the posterior joint density <strong>up to a constant that does not depend on the parameters of interest</strong> (we will not use it in this course).</p>
<p>You can find a useful <a class="reference external" href="https://www.jax.org/news-and-insights/jax-blog/2015/october/lp-in-stan-output"><strong>optional resource</strong></a> if you are more interested in knowing how <code class="docutils literal notranslate"><span class="pre">Stan</span></code> performs its computation.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">round</span><span class="p">(</span><span class="nf">summary</span><span class="p">(</span><span class="n">posterior_bikeshare</span><span class="p">)</span><span class="o">$</span><span class="n">summary</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)[</span><span class="m">-7</span><span class="p">,</span><span class="w"> </span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="dataframe">
<caption>A matrix: 6 × 10 of type dbl</caption>
<thead>
	<tr><th></th><th scope=col>mean</th><th scope=col>se_mean</th><th scope=col>sd</th><th scope=col>2.5%</th><th scope=col>25%</th><th scope=col>50%</th><th scope=col>75%</th><th scope=col>97.5%</th><th scope=col>n_eff</th><th scope=col>Rhat</th></tr>
</thead>
<tbody>
	<tr><th scope=row>a[1]</th><td> 9.46</td><td>0</td><td>0.01</td><td> 9.44</td><td> 9.46</td><td> 9.47</td><td> 9.47</td><td> 9.49</td><td>423.09</td><td>1</td></tr>
	<tr><th scope=row>a[2]</th><td> 8.20</td><td>0</td><td>0.03</td><td> 8.16</td><td> 8.19</td><td> 8.20</td><td> 8.22</td><td> 8.25</td><td>427.82</td><td>1</td></tr>
	<tr><th scope=row>a[3]</th><td> 7.00</td><td>0</td><td>0.03</td><td> 6.93</td><td> 6.98</td><td> 7.00</td><td> 7.02</td><td> 7.06</td><td>418.97</td><td>1</td></tr>
	<tr><th scope=row>l[1]</th><td>-0.69</td><td>0</td><td>0.03</td><td>-0.75</td><td>-0.71</td><td>-0.69</td><td>-0.68</td><td>-0.64</td><td>454.05</td><td>1</td></tr>
	<tr><th scope=row>l[2]</th><td>-1.90</td><td>0</td><td>0.06</td><td>-2.02</td><td>-1.95</td><td>-1.91</td><td>-1.86</td><td>-1.78</td><td>480.15</td><td>1</td></tr>
	<tr><th scope=row>l[3]</th><td> 2.78</td><td>0</td><td>0.06</td><td> 2.67</td><td> 2.75</td><td> 2.78</td><td> 2.83</td><td> 2.90</td><td>398.77</td><td>1</td></tr>
</tbody>
</table>
</div></div>
</div>
<p>Before plotting our posterior results, let us recheck the inferential inquiries:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><em>How are temperature and weather associated with the <strong>mean</strong> number of trips?</em></p></li>
<li><p><em>Specifically, does the <strong>mean</strong> number of trips vary by the <strong>type</strong> of weather along with temperature?</em></p></li>
<li><p><em>How can we quantify this variation?</em></p></li>
</ol>
</div></blockquote>
<p>Now, we can also plot the six 95% credible intervals and posterior distributions via <code class="docutils literal notranslate"><span class="pre">mcmc_areas()</span></code> (from package <code class="docutils literal notranslate"><span class="pre">bayesplot</span></code>). Based on our summary and credible intervals, we can conclude the following (<strong>while addressing the previous inquiries</strong>):</p>
<ul class="simple">
<li><p>Indeed, <strong>we have posterior evidence</strong> to state that the rates of change for mean counts of bike rides (<span class="math notranslate nohighlight">\(a_w\)</span>) are different by weather category (the corresponding 95% credible intervals do not overlap!). <strong>A higher rate of change mean count is associated to a nicer weather.</strong></p></li>
<li><p>The temperature elbows <span class="math notranslate nohighlight">\(l_w\)</span> by weather category are also different (the corresponding 95% credible intervals do not overlap!).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">slope_CIs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mcmc_areas</span><span class="p">(</span><span class="n">posterior_bikeshare</span><span class="p">,</span><span class="w"> </span><span class="n">pars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a[1]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a[2]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;a[3]&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">prob_outer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.95</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;95% Credible Intervals and Posterior Distributions by Slope&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">0.25</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Mean Bike Ride Counts/°C&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Slope by Weather Category&quot;</span><span class="p">)</span>

<span class="n">slope_CIs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale for <span class=" -Color -Color-Green">x</span> is already present.
Adding another scale for <span class=" -Color -Color-Green">x</span>, which will replace the existing scale.
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/58af06165f435dd3e5fcb21b924e39757571bdad08838107b9a00daee156e0b9.png"><img alt="../_images/58af06165f435dd3e5fcb21b924e39757571bdad08838107b9a00daee156e0b9.png" src="../_images/58af06165f435dd3e5fcb21b924e39757571bdad08838107b9a00daee156e0b9.png" style="width: 720px; height: 420px;" /></a>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">elbow_CIs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">mcmc_areas</span><span class="p">(</span><span class="n">posterior_bikeshare</span><span class="p">,</span><span class="w"> </span><span class="n">pars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;l[1]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;l[2]&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;l[3]&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">prob_outer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.95</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">,</span><span class="w"> </span><span class="n">family</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;sans&quot;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;95% Credible Intervals and Posterior Distributions by Elbow&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">seq</span><span class="p">(</span><span class="m">-2.5</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0.5</span><span class="p">))</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;°C&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Elbow by Weather Category&quot;</span><span class="p">)</span>

<span class="n">elbow_CIs</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scale for <span class=" -Color -Color-Green">x</span> is already present.
Adding another scale for <span class=" -Color -Color-Green">x</span>, which will replace the existing scale.
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/ac835e56ee8d1a9cd9911a4b2560a72675768e47b715687b6327dfe1337f1692.png"><img alt="../_images/ac835e56ee8d1a9cd9911a4b2560a72675768e47b715687b6327dfe1337f1692.png" src="../_images/ac835e56ee8d1a9cd9911a4b2560a72675768e47b715687b6327dfe1337f1692.png" style="width: 720px; height: 420px;" /></a>
</div>
</div>
<p>We can obtain the <strong>posterior histograms</strong> by parameter via <code class="docutils literal notranslate"><span class="pre">mcmc_hist()</span></code> from <code class="docutils literal notranslate"><span class="pre">bayesplot</span></code>. The posterior distributions look fairly symmetric! <strong>Note that parameters <span class="math notranslate nohighlight">\(a_w\)</span> have positive ranges since we constrain them prior as nonnegative.</strong></p>
<p>Since we have 450 sampled sets of six parameters each, we can plot 450 times our mean count equation</p>
<div class="math notranslate nohighlight">
\[\lambda_w(t) =  \log\{1+\exp[a_w (t - l_{w})]\}  \quad \text{for} \quad w\in\{1,2,3\}.\]</div>
<p>by weather category.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Note the low variability across our 450 samples; the lines practically overlap.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">posterior_samples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.data.frame</span><span class="p">(</span><span class="n">posterior_bikeshare</span><span class="p">)</span>

<span class="n">plot_450_samples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">xlim</span><span class="p">(</span><span class="m">-20</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">theme</span><span class="p">(</span>
<span class="w">    </span><span class="n">plot.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">,</span><span class="w"> </span><span class="n">face</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;bold&quot;</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.text.y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">),</span>
<span class="w">    </span><span class="n">axis.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">21</span><span class="p">),</span>
<span class="w">    </span><span class="n">legend.text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_text</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">,</span><span class="w"> </span><span class="n">margin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">margin</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cm&quot;</span><span class="p">)),</span>
<span class="w">    </span><span class="n">legend.title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">element_blank</span><span class="p">(),</span>
<span class="w">    </span><span class="n">legend.key.size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">unit</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;cm&#39;</span><span class="p">)</span>
<span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Mean Bike Ride Count&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Temperature (C)&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span>
<span class="w">  </span><span class="nf">ggtitle</span><span class="p">(</span><span class="s">&quot;Plots of 450 Samples by Weather Category&quot;</span><span class="p">)</span>

<span class="c1"># Plotting 450 lambda functions for w_1</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">plot_450_samples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_450_samples</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_function</span><span class="p">(</span>
<span class="w">      </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">posterior_samples</span><span class="o">$</span><span class="n">`a[1]`</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span>
<span class="w">          </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">posterior_samples</span><span class="o">$</span><span class="n">`l[1]`</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Weather 1&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Plotting 450 lambda functions for w_2</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">plot_450_samples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_450_samples</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_function</span><span class="p">(</span>
<span class="w">      </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">posterior_samples</span><span class="o">$</span><span class="n">`a[2]`</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span>
<span class="w">          </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">posterior_samples</span><span class="o">$</span><span class="n">`l[2]`</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Weather 2&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Plotting 450 lambda functions for w_3</span>
<span class="nf">for </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">nrow</span><span class="p">(</span><span class="n">posterior_samples</span><span class="p">))</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">plot_450_samples</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">plot_450_samples</span><span class="w"> </span><span class="o">+</span>
<span class="w">    </span><span class="nf">geom_function</span><span class="p">(</span>
<span class="w">      </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nf">log</span><span class="p">(</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">exp</span><span class="p">(</span><span class="n">posterior_samples</span><span class="o">$</span><span class="n">`a[3]`</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">*</span>
<span class="w">          </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">posterior_samples</span><span class="o">$</span><span class="n">`l[3]`</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">      </span><span class="nf">aes</span><span class="p">(</span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Weather 3&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span>
<span class="w">    </span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">plot_450_samples</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nf">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">wes_palette</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;GrandBudapest1&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../_images/753829dd3b05cdafb60a3b9eb46a3f25d0cca6397066de760f55b77c34935562.png"><img alt="../_images/753829dd3b05cdafb60a3b9eb46a3f25d0cca6397066de760f55b77c34935562.png" src="../_images/753829dd3b05cdafb60a3b9eb46a3f25d0cca6397066de760f55b77c34935562.png" style="width: 720px; height: 420px;" /></a>
</div>
</div>
<p>The harshest weather <code class="docutils literal notranslate"><span class="pre">3</span></code> has the smallest slope and largest elbow. On the other hand, the nicest weather <code class="docutils literal notranslate"><span class="pre">1</span></code> has the largest slope but not the smallest elbow!</p>
<div class="exercise admonition" id="lecture4-q4">

<p class="admonition-title"><span class="caption-number">Exercise 14 </span></p>
<section id="exercise-content">
<p>Once we have estimated our Bayesian model, what do you think is the major drawback? Thus, how can we improve this model?</p>
</section>
</div>
</section>
</section>
<section id="wrapping-up">
<h2>6. Wrapping Up<a class="headerlink" href="#wrapping-up" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We have built a Bayesian generative model totally from scratch by setting up key mathematical relations between our variables of interest.</p></li>
<li><p>Knowing the suitable class of distributions to use is of particular importance.</p></li>
<li><p>There is more than one possible modelling approach, and all models can be improved!</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            name: "ir",
            path: "./notes"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="lecture3_beta_binomial_Bayesian_modelling.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lecture 3 - Bayesian Statistics in Action: The Beta-Binomial Model</p>
      </div>
    </a>
    <a class="right-next"
       href="lecture5_hypothesis_testing_intro_regression.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lecture 5 - Bayesian Normal Linear Regression and Hypothesis Testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#today-s-learning-objectives">Today’s Learning Objectives</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-r-packages">Loading <code class="docutils literal notranslate"><span class="pre">R</span></code> Packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#previously">Previously…</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-big-idea">1. The Big Idea</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-design-the-model-think-generatively">1.1. To Design the Model, Think Generatively!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#constructing-the-likelihood">1.2. Constructing the Likelihood</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-bikeshare-data">2. The Bikeshare Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-wrangling">2.1. Data Wrangling</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exploratory-data-analysis">2.2. Exploratory Data Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bikeshare-likelihood">3. Bikeshare Likelihood</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-the-bike-ride-counts">3.1. Modelling the Bike Ride Counts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-the-weather-parameters">3.2. Modelling the Weather Parameters</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview-of-markov-chain-monte-carlo">4. Overview of Markov Chain Monte Carlo</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monte-carlo-algorithm">4.1. Monte Carlo Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#markov-chain">4.2. Markov Chain</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-metropolis-hastings-algorithm">4.3. The Metropolis-Hastings Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-metropolis-algorithm">4.4.  The Metropolis Algorithm</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#other-mcmc-algorithms">4.5.  Other MCMC Algorithms</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#important-facts-to-consider-when-sampling-via-rstan">4.6.  Important Facts to Consider when <code class="docutils literal notranslate"><span class="pre">sampling()</span></code> via <code class="docutils literal notranslate"><span class="pre">rstan</span></code></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-stan-to-obtain-our-posterior-distribution">5. Using <code class="docutils literal notranslate"><span class="pre">Stan</span></code> to Obtain our Posterior Distribution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coding-the-model">5.1. Coding the Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mcmc-simulation">5.2. MCMC Simulation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#obtaining-visualizing-and-interpreting-the-posterior-results">5.3. Obtaining, Visualizing, and Interpreting the Posterior Results</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wrapping-up">6. Wrapping Up</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By G. Alexi Rodríguez-Arelis, Hedayat Zarkoob, Michael Gelbart, and Trevor Campbell
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>